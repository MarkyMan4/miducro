(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const ve=60,Mt=1/ve;let ft=[],oi=[],Ii=0,Q=0,qe=0,J=0;const ai=[],li=[];function Oi(i,t){i&&ai.push(i),t&&li.push(t)}async function Li(i,t,e,s,n,r=[],o=document.body){i||=()=>{},t||=()=>{},e||=()=>{},s||=()=>{},n||=()=>{};function h(){V=c(C.width,C.height),nt.imageSmoothingEnabled=dt.imageSmoothingEnabled=!1,ii()}function d(f=0){let y=f-qe;qe=f,J+=y,J=pt(J,50);let x=!1;{let S=0;for(J<0&&J>-9&&(S=J,J=0);J>=0;J-=1e3/ve)Q=Ii++/ve,x=!0,u(),us(),t(),ai.forEach(w=>w()),Mi(),e(),ds();J+=S}v(),requestAnimationFrame(d);function v(){x||u(),h(),s(),ft.sort((S,w)=>S.renderOrder-w.renderOrder);for(const S of ft)S.destroyed||S.render();n(),li.forEach(S=>S()),Bt()}}function u(){if(j.x){C.width=j.x,C.height=j.y;const x=innerWidth/innerHeight,v=C.width/C.height;(U||C).style.width=C.style.width=q.style.width=x<v?"100%":"",(U||C).style.height=C.style.height=q.style.height=x<v?"":"100%"}else C.width=pt(innerWidth,Ze.x),C.height=pt(innerHeight,Ze.y);Te.a>0&&(dt.fillStyle=Te.toString(),dt.fillRect(0,0,V.x,V.y),dt.fillStyle=ht.toString()),q.width=C.width,q.height=C.height,V=c(C.width,C.height);const f="round",y="round";dt.lineJoin=nt.lineJoin=f,dt.lineCap=nt.lineCap=y}async function l(){await i(),d()}const m="margin:0;overflow:hidden;background:#000;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none";o.style.cssText=m,Ee=C=document.createElement("canvas"),o.appendChild(C),le=dt=C.getContext("2d"),fs(),ms(),Rs(),q=document.createElement("canvas"),o.appendChild(q),nt=q.getContext("2d");const p="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";C.style.cssText=q.style.cssText=p,U&&(U.style.cssText=p),Zi(ui),$i(di),u(),ii(),At=new OffscreenCanvas(256,256),_t=At.getContext("2d",{willReadFrequently:!0});const g=r.map((f,y)=>new Promise(x=>{const v=new Image;v.onerror=v.onload=()=>{const S=new Ae(v);S.createWebGLTexture(),Ft[y]=S,x()},v.crossOrigin="anonymous",v.src=f}));return r.length||g.push(new Promise(f=>{const y=new Ae(new Image);Ft[0]=y,y.createWebGLTexture(),f()})),await Promise.all(g),l()}function Mi(){oi=ft.filter(t=>t.collideSolidObjects);function i(t){if(!t.destroyed){t.update();for(const e of t.children)i(e)}}for(const t of ft)t.parent||(i(t),t.updateTransforms());ft=ft.filter(t=>!t.destroyed)}const Ht=Math.PI;function X(i){return Math.abs(i)}function pt(...i){return Math.min(...i)}function Rt(...i){return Math.max(...i)}function Pt(i){return Math.sign(i)}function Dt(i,t=1){return(i%t+t)%t}function P(i,t=0,e=1){return i<t?t:i>e?e:i}function jt(i,t,e){return(e-=t)?P((i-t)/e):0}function Zt(i,t,e){return i>=0&&i<=1&&(t<0||t>1)&&(e<0||e>1)&&console.warn("lerp() parameter order changed! use lerp(start, end, p)"),i+P(e)*(t-i)}function Se(i,t,e,s=c()){const n=(i.x-e.x)*2,r=(i.y-e.y)*2,o=t.x+s.x,h=t.y+s.y;return n>=-o&&n<o&&r>=-h&&r<h}function Et(i){return typeof i=="number"&&!isNaN(i)}function O(i=1,t=0){return t+Math.random()*(i-t)}function _(i,t=0){return Math.floor(O(i,t))}function ji(i=.5){return O()<i}function we(){return _(2)*2-1}function hi(i=1){return new R().setAngle(O(2*Ht),i)}function Fi(i=1,t=0){return i>0?hi(i*O(t/i,1)**.5):new R}function Qe(i=new I,t=new I(0,0,0,1),e=!1){return e?i.lerp(t,O()):new I(O(i.r,t.r),O(i.g,t.g),O(i.b,t.b),O(i.a,t.a))}function c(i=0,t){return new R(i,t===void 0?i:t)}function rt(i){return i instanceof R&&i.isValid()}function Bi(i){rt(i)}class R{constructor(t=0,e=0){this.x=t,this.y=e,this.isValid()}set(t=0,e=0){return this.x=t,this.y=e,this}copy(){return new R(this.x,this.y)}add(t){return new R(this.x+t.x,this.y+t.y)}subtract(t){return new R(this.x-t.x,this.y-t.y)}multiply(t){return new R(this.x*t.x,this.y*t.y)}divide(t){return new R(this.x/t.x,this.y/t.y)}scale(t){return new R(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new R(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}reflect(t,e=1){return this.subtract(t.scale((1+e)*this.dot(t)))}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(-t),s=Math.sin(-t);return new R(this.x*e-this.y*s,this.x*s+this.y*e)}setDirection(t,e=1){return t=Dt(t,4),c(t%2?t-1?-e:e:0,t%2?0:t?-e:e)}direction(){return X(this.x)>X(this.y)?this.x<0?3:1:this.y<0?2:0}abs(){return new R(X(this.x),X(this.y))}floor(){return new R(Math.floor(this.x),Math.floor(this.y))}mod(t=1){return new R(Dt(this.x,t),Dt(this.y,t))}area(){return X(this.x*this.y)}lerp(t,e){Bi(t);const s=P(e);return new R(t.x*s+this.x*(1-s),t.y*s+this.y*(1-s))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return this.isValid()?`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`:`(${this.x}, ${this.y})`}isValid(){return Et(this.x)&&Et(this.y)}}function k(i,t,e,s){return new I(i,t,e,s)}function G(i,t,e,s){return new I().setHSLA(i,t,e,s)}function lt(i){return i instanceof I&&i.isValid()}function pe(i){lt(i)}class I{constructor(t=1,e=1,s=1,n=1){this.r=t,this.g=e,this.b=s,this.a=n,this.isValid()}set(t=1,e=1,s=1,n=1){return this.r=t,this.g=e,this.b=s,this.a=n,this}copy(){return new I(this.r,this.g,this.b,this.a)}add(t){return new I(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new I(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new I(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new I(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new I(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new I(P(this.r),P(this.g),P(this.b),P(this.a))}lerp(t,e){pe(t);const s=P(e);return new I(t.r*s+this.r*(1-s),t.g*s+this.g*(1-s),t.b*s+this.b*(1-s),t.a*s+this.a*(1-s))}setHSLA(t=0,e=0,s=1,n=1){t=Dt(t,1),e=P(e),s=P(s);const r=s<.5?s*(1+e):s+e-s*e,o=2*s-r,h=(d,u,l)=>(l=Dt(l,1))*6<1?d+(u-d)*6*l:l*2<1?u:l*3<2?d+(u-d)*(4-l*6):d;return this.r=h(o,r,t+1/3),this.g=h(o,r,t),this.b=h(o,r,t-1/3),this.a=n,pe(this),this}HSLA(){const t=P(this.r),e=P(this.g),s=P(this.b),n=P(this.a),r=Rt(t,e,s),o=pt(t,e,s),h=(r+o)/2;let d=0,u=0;if(r!==o){let l=r-o;u=h>.5?l/(2-r-o):l/(r+o),t===r?d=(e-s)/l+(e<s?6:0):e===r?d=(s-t)/l+2:s===r&&(d=(t-e)/l+4)}return[d/6,u,h,n]}mutate(t=.05,e=0){return new I(this.r+O(t,-t),this.g+O(t,-t),this.b+O(t,-t),this.a+O(e,-e)).clamp()}toString(t=!0){const e=s=>((s=P(s)*255|0)<16?"0":"")+s.toString(16);return"#"+e(this.r)+e(this.g)+e(this.b)+(t?e(this.a):"")}setHex(t){if(typeof t=="string"&&t[0],[4,5,7,9].includes(t.length),t.length<6){const e=s=>P(parseInt(t[s],16)/15);this.r=e(1),this.g=e(2),this.b=e(3),this.a=t.length===5?e(4):1}else{const e=s=>P(parseInt(t.slice(s,s+2),16)/255);this.r=e(1),this.g=e(3),this.b=e(5),this.a=t.length===9?e(7):1}return pe(this),this}rgbaInt(){const t=P(this.r)*255|0,e=P(this.g)*255<<8,s=P(this.b)*255<<16,n=P(this.a)*255<<24;return t+e+s+n}isValid(){return Et(this.r)&&Et(this.g)&&Et(this.b)&&Et(this.a)}}const vt=k();k(1,1,1,0);const ht=k(0,0,0),ci=k(0,0,0,0);k(.5,.5,.5);k(1,0,0);k(1,.5,0);k(1,1,0);k(0,1,0);k(0,1,1);k(0,0,1);k(.5,0,1);k(1,0,1);class Ui{constructor(t){this.time=t===void 0?void 0:Q+t,this.setTime=t}set(t=0){this.time=Q+t,this.setTime=t}unset(){this.time=void 0}isSet(){return this.time!==void 0}active(){return Q<this.time}elapsed(){return Q>=this.time}get(){return this.isSet()?Q-this.time:0}getPercent(){return this.isSet()?1-jt(this.time-Q,0,this.setTime):0}getSetTime(){return this.isSet()?this.setTime:0}toString(){return this.isSet()?Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after"):"unset"}valueOf(){return this.get()}}let bt=c(),Yt=0,L=32,Te=ci,Ze=c(1920,1080),j=c(),ui=!0,di=!1,Ni="arial",ki=!1,K=!0,_i=32,fi=c(16),Yi=0,Wi=1,Xi=1,zi=1,Hi=0,Gi=.8,gt=1,me=c(),$e=1,ye=!0,Vi=.3,Ki=40,Ji=.7;c(640,80);function qi(i){Te=i}function Qi(i){j=i}function Zi(i){ui=i,C&&(C.style.imageRendering=i?"pixelated":""),U&&(U.style.imageRendering=i?"pixelated":"")}function $i(i){di=i,q&&(q.style.imageRendering=i?"pixelated":"")}class St{constructor(t=c(),e=c(1),s,n=0,r=new I,o=0){rt(t),rt(e),lt(r),this.pos=t.copy(),this.size=e.copy(),this.drawSize=void 0,this.tileInfo=s,this.angle=n,this.color=r.copy(),this.additiveColor=void 0,this.mirror=!1,this.mass=Wi,this.damping=Xi,this.angleDamping=zi,this.restitution=Hi,this.friction=Gi,this.gravityScale=1,this.renderOrder=o,this.velocity=c(),this.angleVelocity=0,this.spawnTime=Q,this.children=[],this.clampSpeed=!0,this.groundObject=void 0,this.parent=void 0,this.localPos=c(),this.localAngle=0,this.collideTiles=!1,this.collideSolidObjects=!1,this.isSolid=!1,this.collideRaycast=!1,ft.push(this)}updateTransforms(){const t=this.parent;if(t){const e=t.getMirrorSign();this.pos=this.localPos.multiply(c(e,1)).rotate(t.angle).add(t.pos),this.angle=e*this.localAngle+t.angle}for(const e of this.children)e.updateTransforms()}update(){if(this.parent)return;this.clampSpeed&&(this.velocity.x=P(this.velocity.x,-gt,gt),this.velocity.y=P(this.velocity.y,-gt,gt));const t=this.pos.copy();if(this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.mass&&(this.velocity.x+=me.x*this.gravityScale,this.velocity.y+=me.y*this.gravityScale),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.angle+=this.angleVelocity*=this.angleDamping,this.angleDamping>=0&&this.angleDamping<=1,this.damping>=0&&this.damping<=1,!this.mass)return;const e=this.velocity.y<0;if(this.groundObject){const s=Rt(this.friction,this.groundObject.friction),n=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=n+(this.velocity.x-n)*s,this.groundObject=void 0}if(this.collideSolidObjects)for(const n of oi){if(!this.isSolid&&!n.isSolid||n.destroyed||n.parent||n===this||!Se(this.pos,this.size,n.pos,n.size))continue;const r=this.collideWithObject(n),o=n.collideWithObject(this);if(!r||!o)continue;if(Se(t,this.size,n.pos,n.size)){const p=t.subtract(n.pos),g=p.length(),f=.001,y=g<.01?hi(f):p.scale(f/g);this.velocity=this.velocity.add(y),n.mass&&(n.velocity=n.velocity.subtract(y));continue}const h=this.size.add(n.size),d=(t.y-n.pos.y)*2>h.y+me.y,u=X(t.y-n.pos.y)*2<h.y,l=X(t.x-n.pos.x)*2<h.x,m=Rt(this.restitution,n.restitution);if(d||l||!u){if(this.pos.y=n.pos.y+(h.y/2+.001)*Pt(t.y-n.pos.y),n.groundObject&&e||!n.mass)e&&(this.groundObject=n),this.velocity.y*=-m;else if(n.mass){const p=(this.mass*this.velocity.y+n.mass*n.velocity.y)/(this.mass+n.mass),g=this.velocity.y*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.y*2*n.mass/(this.mass+n.mass),f=n.velocity.y*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.y*2*this.mass/(this.mass+n.mass);this.velocity.y=Zt(p,g,m),n.velocity.y=Zt(p,f,m)}}if(!d&&u)if(this.pos.x=n.pos.x+(h.x/2+.001)*Pt(t.x-n.pos.x),n.mass){const p=(this.mass*this.velocity.x+n.mass*n.velocity.x)/(this.mass+n.mass),g=this.velocity.x*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.x*2*n.mass/(this.mass+n.mass),f=n.velocity.x*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.x*2*this.mass/(this.mass+n.mass);this.velocity.x=Zt(p,g,m),n.velocity.x=Zt(p,f,m)}else this.velocity.x*=-m}if(this.collideTiles){const s=te(this.pos,this.size,this);if(s&&!te(t,this.size,this)){const n=te(c(t.x,this.pos.y),this.size,this),r=te(c(this.pos.x,t.y),this.size,this);if(n||!r){const o=Rt(this.restitution,s.restitution);this.velocity.y*=-o,e?(this.pos.y=(t.y-this.size.y/2|0)+this.size.y/2+1e-4,this.groundObject=s):(this.pos.y=t.y,this.groundObject=void 0)}r&&(this.pos.x=t.x,this.velocity.x*=-this.restitution)}}}render(){tt(this.pos,this.drawSize||this.size,this.tileInfo,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.parent=0,t.destroy()}}localToWorld(t){return this.pos.add(t.rotate(this.angle))}worldToLocal(t){return t.subtract(this.pos).rotate(-this.angle)}localToWorldVector(t){return t.rotate(this.angle)}worldToLocalVector(t){return t.rotate(-this.angle)}collideWithTile(t,e){return t>0}collideWithObject(t){return!0}getAliveTime(){return Q-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyAngularAcceleration(t){this.mass&&(this.angleVelocity+=t)}applyForce(t){this.mass&&this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,e=c(),s=0){!t.parent&&this.children.includes(t),this.children.push(t),t.parent=this,t.localPos=e.copy(),t.localAngle=s}removeChild(t){t.parent===this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=!0,e=!0,s=!0,n=!0){this.collideSolidObjects=t,this.isSolid=e,this.collideTiles=s,this.collideRaycast=n}toString(){}renderDebugInfo(){}}let C,dt,q,nt,Ee,le,At,_t,V=c(),Ft=[];function he(i=new R,t=fi,e=0,s=0){typeof t=="number"&&(t=new R(t,t));const n=new De(new R,t,e,s),r=Ft[e],o=t.x+s*2,h=t.y+s*2;if(typeof i=="number"){const d=r.size.x/o|0,u=i%d,l=i/d|0;n.pos.set(u*o+s,l*h+s)}else n.pos.set(i.x*o+s,i.y*h+s);return n}class De{constructor(t=c(),e=fi,s=0,n=0,r=Yi){this.pos=t.copy(),this.size=e.copy(),this.textureIndex=s,this.padding=n,this.textureInfo=Ft[this.textureIndex],this.bleedScale=r}offset(t){return new De(this.pos.add(t),this.size,this.textureIndex,this.padding,this.bleedScale)}frame(t){return this.offset(new R(t*(this.size.x+this.padding*2),0))}setFullImage(t,e){return this.pos=new R,this.size=new R(t.width,t.height),this.textureInfo=new Ae(t,e),this.bleedScale=this.padding=0,this}}class Ae{constructor(t,e){this.image=t,this.size=c(t.width,t.height),this.sizeInverse=c(1/t.width,1/t.height),this.glTexture=e}createWebGLTexture(){this.glTexture,K&&(this.glTexture=Os(this.image))}}function tt(i,t=new R(1),e,s=vt,n=0,r,o,h=K,d,u){rt(i),rt(t),lt(s)&&(!o||lt(o));const l=e&&e.textureInfo,m=e?e.bleedScale:0;if(h)if(d&&(i=Oe(i),t=t.scale(1/L)),l){const p=l.sizeInverse,g=e.pos.x*p.x,f=e.pos.y*p.y,y=e.size.x*p.x,x=e.size.y*p.y;if(Is(l.glTexture),m){const v=p.x*m,S=p.y*m;xe(i.x,i.y,r?-t.x:t.x,t.y,n,g+v,f+S,g-v+y,f-S+x,s.rgbaInt(),o&&o.rgbaInt())}else xe(i.x,i.y,r?-t.x:t.x,t.y,n,g,f,g+y,f+x,s.rgbaInt(),o&&o.rgbaInt())}else xe(i.x,i.y,t.x,t.y,n,0,0,0,0,0,s.rgbaInt());else t=new R(t.x,-t.y),Ie(i,t,n,r,p=>{if(l){const g=e.pos.x,f=e.pos.y,y=e.size.x,x=e.size.y;os(p,l.image,g,f,y,x,-.5,-.5,1,1,s,o,m)}else{const g=o?s.add(o):s;p.fillStyle=g.toString(),p.fillRect(-.5,-.5,1,1)}},d,u)}function ts(i,t,e,s,n,r,o){tt(i,t,void 0,e,s,!1,void 0,n,r,o)}function es(i,t=c(1),e=3,s=vt,n=0,r=ht,o=0,h=K,d=!1,u){rt(t);const l=[],m=t.x/2,p=t.y/2;for(let g=e;g--;){const f=g/e*Ht*2;l.push(c(Math.sin(f)*m,Math.cos(f)*p))}is(l,s,n,r,i,o,h,d,u)}function is(i,t=vt,e=0,s=ht,n=c(),r=0,o=K,h=!1,d=void 0){if(rt(n),lt(t)&&lt(s),o){let u=1;h&&(n=Oe(n),u=1/L),bi(i,t.rgbaInt(),n.x,n.y,u,u,r),e>0&&Ms(i,s.rgbaInt(),e,n.x,n.y,u,u,r)}else Ie(n,c(1),r,!1,u=>{u.fillStyle=t.toString(),u.beginPath();for(const l of i)u.lineTo(l.x,l.y);u.closePath(),u.fill(),e&&(u.strokeStyle=s.toString(),u.lineWidth=e,u.stroke())},h,d)}function ss(i,t=c(1),e=vt,s=0,n=0,r=ht,o=K,h=!1,d){rt(i),rt(t),lt(e)&&lt(r),n>=0&&n<t.x&&n<t.y,o?es(i,t,_i,e,n,r,s,o,h,d):Ie(i,c(1),s,!1,u=>{u.fillStyle=e.toString(),u.beginPath(),u.ellipse(0,0,t.x/2,t.y/2,0,0,9),u.fill(),n&&(u.strokeStyle=r.toString(),u.lineWidth=n,u.stroke())},h,d)}function ns(i,t=1,e=vt,s=0,n=ht,r=K,o=!1,h){ss(i,c(t),e,0,s,n,r,o,h)}function Ie(i,t,e=0,s=!1,n,r=!1,o=le){r||(i=Le(i),t=t.scale(L)),o.save(),o.translate(i.x+.5,i.y+.5),o.rotate(e-Yt),o.scale(s?-t.x:t.x,-t.y),n(o),o.restore()}function rs(i,t,e=1,s=vt,n=0,r=ht,o="center",h=Ni,d,u=nt){u.fillStyle=s.toString(),u.strokeStyle=r.toString(),u.lineWidth=n,u.textAlign=o,u.font=e+"px "+h,u.textBaseline="middle";const l=(i+"").split(`
`);let m=t.y;m-=(l.length-1)*e/2,l.forEach(p=>{n&&u.strokeText(p,t.x,m,d),u.fillText(p,t.x,m,d),m+=e})}function Oe(i){let t=(i.x-V.x/2+.5)/L,e=(i.y-V.y/2+.5)/-L;return new R(t+bt.x,e+bt.y)}function Le(i){let t=i.x-bt.x,e=i.y-bt.y;return new R(t*L+V.x/2-.5,e*-L+V.y/2-.5)}function ti(i=!1,t){Jt=i,t||=le,t.globalCompositeOperation=i?"lighter":"source-over"}function os(i,t,e,s,n,r,o,h,d,u,l,m,p=0){function g(w){return w.r>=1&&w.g>=1&&w.b>=1}function f(w){return w.r<=0&&w.g<=0&&w.b<=0&&w.a<=0}const y=p,x=p,v=n-2*p,S=r-2*p;if(m?g(l.add(m))&&m.a<=0:g(l))i.globalAlpha=l.a,i.drawImage(t,e+y,s+x,v,S,o,h,d,u),i.globalAlpha=1;else{At.width=n,At.height=r,_t.drawImage(t,e,s,n,r,0,0,n,r);const w=_t.getImageData(0,0,n,r),D=w.data;if(m&&!f(m)){const T=[l.r,l.g,l.b,l.a],E=[m.r*255,m.g*255,m.b*255,m.a*255];for(let A=0;A<D.length;++A)D[A]=D[A]*T[A&3]+E[A&3]|0;_t.putImageData(w,0,0),i.drawImage(At,y,x,v,S,o,h,d,u)}else{for(let T=0;T<D.length;T+=4)D[T]*=l.r,D[T+1]*=l.g,D[T+2]*=l.b;_t.putImageData(w,0,0),i.globalAlpha=l.a,i.drawImage(At,y,x,v,S,o,h,d,u),i.globalAlpha=1}}}let $t;class as{constructor(t,e=c(8),s=c(0,1),n=nt){$t||($t=new Image,$t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=t||$t,this.tileSize=e,this.paddingSize=s}drawText(t,e,s=1,n,r=le){this.drawTextScreen(t,Le(e).floor(),s*L|0,n,r)}drawTextOverlay(t,e,s=4,n){this.drawText(t,e,s,n,nt)}drawTextScreen(t,e,s=4,n,r=nt){r.save();const o=this.tileSize,h=o.add(this.paddingSize).scale(s),d=this.image.width/this.tileSize.x|0;(t+"").split(`
`).forEach((u,l)=>{const m=n?u.length*o.x*s/2|0:0;for(let p=u.length;p--;){let g=u[p].charCodeAt(0);(g<32||g>127)&&(g=127);const f=g-32,y=f%d,x=f/d|0,v=e.add(c(p,l).multiply(h));r.drawImage(this.image,y*o.x,x*o.y,o.x,o.y,v.x-m,v.y,o.x*s,o.y*s)}}),r.restore()}}function Me(i,t=0){return M[t]&&!!(M[t][i]&1)}function Ce(i,t=0){return M[t]&&!!(M[t][i]&2)}function ls(i="ArrowUp",t="ArrowDown",e="ArrowLeft",s="ArrowRight"){const n=r=>Me(r)?1:0;return c(n(s)-n(e),n(i)-n(t))}function gi(){M=[[]]}function hs(i,t=0,e=!0,s=!0,n=!0){M[t]&&(M[t][i]&=~((e?1:0)|(s?2:0)|(n?4:0)))}function pi(i){return Me(i)}function cs(i){return Ce(i)}let ne=c(),at=c();c();let mt=c();function kt(i,t=0){return Me(i,t+1)}let M=[[]];function us(){!It&&!document.hasFocus()&&gi(),ne=Oe(at),mt.multiply(c(1,-1)).rotate(-Yt),gs()}function ds(){for(const i of M)for(const t in i)i[t]&=1;c(),mt=c()}function fs(){document.addEventListener("keydown",i),document.addEventListener("keyup",t),document.addEventListener("mousedown",s),document.addEventListener("mouseup",n),document.addEventListener("mousemove",r),document.addEventListener("wheel",o),document.addEventListener("contextmenu",h),document.addEventListener("blur",d),document.addEventListener("mouseleave",u),It&&ye&&ps();function i(l){l.repeat||(M[0][l.code]=3,M[0][e(l.code)]=3)}function t(l){M[0][l.code]=M[0][l.code]&2|4,M[0][e(l.code)]=4}function e(l){return l==="KeyW"?"ArrowUp":l==="KeyS"?"ArrowDown":l==="KeyA"?"ArrowLeft":l==="KeyD"?"ArrowRight":l}function s(l){It&&ye||(F&&!Fe()&&F.resume(),M[0][l.button]=3,at=Re(c(l.x,l.y)),l.button&&l.preventDefault())}function n(l){It&&ye||(M[0][l.button]=M[0][l.button]&2|4)}function r(l){at=Re(c(l.x,l.y)),mt=mt.add(c(l.movementX,l.movementY))}function o(l){l.ctrlKey||Pt(l.deltaY)}function h(l){l.preventDefault()}function d(){gi()}function u(){at=c(-1),mt=c(0)}}function Re(i){const t=C.getBoundingClientRect(),e=jt(i.x,t.left,t.right),s=jt(i.y,t.top,t.bottom);return c(e*C.width,s*C.height)}const ei=[];function gs(){const i=e=>{const r=o=>o>.3?jt(o,.3,.8):o<-.3?-jt(-o,.3,.8):0;return c(r(e.x),r(-e.y)).clampLength()};if(!navigator||!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e],n=M[e+1]||(M[e+1]=[]),r=ei[e]||(ei[e]=[]);if(s){for(let o=0;o<s.axes.length-1;o+=2)r[o>>1]=i(c(s.axes[o],s.axes[o+1]));for(let o=s.buttons.length;o--;){const h=s.buttons[o],d=kt(o,e);n[o]=h.pressed?d?1:3:d?4:0,(!h.value||h.value>.9)&&!e&&h.pressed}{const o=c((kt(15,e)&&1)-(kt(14,e)&&1),(kt(12,e)&&1)-(kt(13,e)&&1));o.lengthSquared()&&(r[0]=o.clampLength())}}}}const It=window.ontouchstart!==void 0;c();function ps(){let i=e;document.addEventListener("touchstart",s=>i(s),{passive:!1}),document.addEventListener("touchmove",s=>i(s),{passive:!1}),document.addEventListener("touchend",s=>i(s),{passive:!1});let t;function e(s){F&&!Fe()&&F.resume();const n=s.touches.length,r=0;if(n){const o=c(s.touches[0].clientX,s.touches[0].clientY),h=at;at=Re(o),t?mt=mt.add(at.subtract(h)):M[0][r]=3}else t&&(M[0][r]=M[0][r]&2|4);return t=n,document.hasFocus()&&s.cancelable&&s.preventDefault(),!0}}let F=new AudioContext,ee;const je=44100;function Fe(){return F.state==="running"}function ms(){ee=F.createGain(),ee.connect(F.destination),ee.gain.value=Vi}class et{constructor(t,e=Ki,s=Ji){this.range=e,this.taper=s,this.randomness=0,this.sampleRate=je,this.loadedPercent=0,t&&(this.randomness=t[1]!==void 0?t[1]:.05,t[1]=0,this.sampleChannels=[vs(...t)],this.loadedPercent=1)}play(t,e=1,s=1,n=1,r=!1,o=!1){if(!this.sampleChannels)return;let h;if(t){const u=this.range;if(u){const l=bt.distanceSquared(t);if(l>u*u)return;e*=jt(l**.5,u,u*this.taper)}h=Le(t).x*2/C.width-1}const d=s+s*this.randomness*n*O(-1,1);return new ys(this,e,d,h,r,o)}playMusic(t=1,e=!0,s=!1){return this.play(void 0,t,1,0,e,s)}playNote(t,e,s){const n=xs(t,1);return this.play(e,s,n,0)}getDuration(){return this.sampleChannels&&this.sampleChannels[0].length/this.sampleRate}isLoaded(){return this.loadedPercent===1}}class ys{constructor(t,e=1,s=1,n=0,r=!1,o=!1){this.sound=t,this.volume=e,this.rate=s,this.pan=n,this.loop=r,this.pausedTime=0,this.startTime=void 0,this.gainNode=void 0,this.source=void 0,this.onendedCallback=h=>{h===this.source&&(this.source=void 0)},o||this.start()}start(t=0){this.isPlaying()&&this.stop(),this.gainNode=F.createGain(),this.source=bs(this.sound.sampleChannels,this.volume,this.rate,this.pan,this.loop,this.sound.sampleRate,this.gainNode,t,this.onendedCallback),this.startTime=F.currentTime-t,this.pausedTime=void 0}setVolume(t){this.volume=t,this.gainNode&&(this.gainNode.gain.value=t)}stop(t=0){if(this.isPlaying())if(t){const e=F.currentTime,s=e+t;this.gainNode.gain.linearRampToValueAtTime(1,e),this.gainNode.gain.linearRampToValueAtTime(0,s),this.source.stop(s)}else this.source.stop();this.pausedTime=0,this.source=void 0,this.startTime=void 0}pause(){this.isPaused()||(this.pausedTime=this.getCurrentTime(),this.source.stop(),this.source=void 0,this.startTime=void 0)}resume(){this.isPaused()&&this.start(this.pausedTime)}isPlaying(){return!!this.source}isPaused(){return!this.isPlaying()}getCurrentTime(){const t=Dt(F.currentTime-this.startTime,this.getDuration());return this.isPlaying()?t:this.pausedTime}getDuration(){return this.sound.getDuration()/this.rate}getSource(){return this.source}}function xs(i,t=220){return t*2**(i/12)}function bs(i,t=1,e=1,s=0,n=!1,r=je,o,h=0,d){const u=i.length,l=i[0].length,m=F.createBuffer(u,l,r),p=F.createBufferSource();i.forEach((y,x)=>m.getChannelData(x).set(y)),p.buffer=m,p.playbackRate.value=e,p.loop=n,o=o||F.createGain(),o.gain.value=t,o.connect(ee);const g=new StereoPannerNode(F,{pan:P(s,-1,1)});if(p.connect(g).connect(o),d&&p.addEventListener("ended",()=>d(p)),!Fe()){F.resume();return}const f=h*e;return p.start(0,f),p}function vs(i=1,t=.05,e=220,s=0,n=0,r=.1,o=0,h=1,d=0,u=0,l=0,m=0,p=0,g=0,f=0,y=0,x=0,v=1,S=0,w=0,D=0){let T=je,E=Ht*2,A=d*=500*E/T/T,Y=e*=(1+O(t,-t))*E/T,Ut=0,Nt=0,wt=0,ut=1,Tt,de=[],ot=0,B=0,W=0,fe,Ai=2,Xe=E*X(D)*2/T,ge=Math.cos(Xe),ze=Math.sin(Xe)/2/Ai,Qt=1+ze,Ci=-2*ge/Qt,Ri=(1-ze)/Qt,He=(1+Pt(D)*ge)/2/Qt,Pi=-(Pt(D)+ge)/Qt,Di=He,Ge=0,Ve=0,Ke=0,Je=0;for(s=s*T||9,S*=T,n*=T,r*=T,x*=T,u*=500*E/T**3,f*=E/T,l*=E/T,m*=T,p=p*T|0,Tt=s+S+n+r+x|0;B<Tt;de[B++]=W*i)++wt%(y*100|0)||(W=o?o>1?o>2?o>3?o>4?ot/E%1<h/2?1:-1:Math.sin(ot**3):Math.max(Math.min(Math.tan(ot),1),-1):1-(2*ot/E%2+2)%2:1-4*X(Math.round(ot/E)-ot/E):Math.sin(ot),W=(p?1-w+w*Math.sin(E*B/p):1)*(o>4?W:Pt(W)*X(W)**h)*(B<s?B/s:B<s+S?1-(B-s)/S*(1-v):B<s+S+n?v:B<Tt-x?(Tt-B-x)/r*v:0),W=x?W/2+(x>B?0:(B<Tt-x?1:(Tt-B)/x)*de[B-x|0]/2/i):W,D&&(W=Je=Di*Ge+Pi*(Ge=Ve)+He*(Ve=W)-Ri*Ke-Ci*(Ke=Je))),fe=(e+=d+=u)*Math.cos(f*Ut++),ot+=fe+fe*g*Math.sin(B**5),ut&&++ut>m&&(e+=l,Y+=l,ut=0),p&&!(++Nt%p)&&(e=Y,d=A,ut||=1);return de}const Ss=[];function te(i,t=c(),e,s=!0){for(const n of Ss)if((!s||n.isSolid)&&n.collisionTest(i,t,e))return n}class ws extends St{constructor(t,e,s=0,n=0,r=100,o=Ht,h,d=new I,u=new I,l=new I(1,1,1,0),m=new I(1,1,1,0),p=.5,g=.1,f=1,y=.1,x=.05,v=1,S=1,w=0,D=Ht,T=.1,E=.2,A=!1,Y=!1,Ut=!0,Nt=Y?1e9:0,wt=!1){super(t,c(),h,e,void 0,Nt),this.emitSize=s,this.emitTime=n,this.emitRate=r,this.emitConeAngle=o,this.colorStartA=d,this.colorStartB=u,this.colorEndA=l,this.colorEndB=m,this.randomColorLinear=Ut,this.particleTime=p,this.sizeStart=g,this.sizeEnd=f,this.speed=y,this.angleSpeed=x,this.damping=v,this.angleDamping=S,this.gravityScale=w,this.particleConeAngle=D,this.fadeRate=T,this.randomness=E,this.collideTiles=A,this.additive=Y,this.localSpace=wt,this.trailScale=0,this.particleDestroyCallback=void 0,this.particleCreateCallback=void 0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime||this.getAliveTime()<=this.emitTime){if(this.emitRate*$e){const t=1/this.emitRate/$e;for(this.emitTimeBuffer+=Mt;this.emitTimeBuffer>0;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy()}emitParticle(){let t=typeof this.emitSize=="number"?Fi(this.emitSize/2):c(O(-.5,.5),O(-.5,.5)).multiply(this.emitSize).rotate(this.angle),e=O(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),e+=this.angle);const s=this.randomness,n=y=>y+y*O(s,-s),r=n(this.particleTime),o=n(this.sizeStart),h=n(this.sizeEnd),d=n(this.speed),u=n(this.angleSpeed)*we(),l=O(this.emitConeAngle,-this.emitConeAngle),m=Qe(this.colorStartA,this.colorStartB,this.randomColorLinear),p=Qe(this.colorEndA,this.colorEndB,this.randomColorLinear),g=this.localSpace?l:this.angle+l,f=new Ts(t,this.tileInfo,e,m,p,r,o,h,this.fadeRate,this.additive,this.trailScale,this.localSpace&&this,this.particleDestroyCallback);return f.velocity=c().setAngle(g,d),f.angleVelocity=u,this.localSpace||(f.velocity.x+=this.velocity.x,f.velocity.y+=this.velocity.y,f.angleVelocity+=this.angleVelocity),f.fadeRate=this.fadeRate,f.damping=this.damping,f.angleDamping=this.angleDamping,f.restitution=this.restitution,f.friction=this.friction,f.gravityScale=this.gravityScale,f.collideTiles=this.collideTiles,f.renderOrder=this.renderOrder,f.mirror=ji(),this.particleCreateCallback&&this.particleCreateCallback(f),f}render(){}}class Ts extends St{constructor(t,e,s,n,r,o,h,d,u,l,m,p,g){super(t,c(),e,s),this.colorStart=n,this.colorEndDelta=r.subtract(n),this.lifeTime=o,this.sizeStart=h,this.sizeEndDelta=d-h,this.fadeRate=u,this.additive=l,this.trailScale=m,this.localSpaceEmitter=p,this.destroyCallback=g,this.clampSpeed=!1}update(){if(super.update(),this.collideTiles||this.collideSolidObjects){const t=this.velocity.lengthSquared();if(t>gt*gt){const e=gt/t**.5;this.velocity.x*=e,this.velocity.y*=e}}}render(){const t=this.lifeTime>0?pt((Q-this.spawnTime)/this.lifeTime,1):1,e=this.sizeStart+t*this.sizeEndDelta,s=c(e),n=this.fadeRate/2,r=new I(this.colorStart.r+t*this.colorEndDelta.r,this.colorStart.g+t*this.colorEndDelta.g,this.colorStart.b+t*this.colorEndDelta.b,(this.colorStart.a+t*this.colorEndDelta.a)*(t<n?t/n:t>1-n?(1-t)/n:1));this.additive&&ti(!0);let o=this.pos,h=this.angle;if(this.localSpaceEmitter&&(o=this.localSpaceEmitter.pos.add(o.rotate(-this.localSpaceEmitter.angle)),h+=this.localSpaceEmitter.angle),this.trailScale){let d=this.velocity;this.localSpaceEmitter&&(d=d.rotate(-this.localSpaceEmitter.angle));const u=d.length();if(u){const l=d.scale(1/u),m=u*this.trailScale;s.y=Rt(s.x,m),h=l.angle(),tt(o.add(l.multiply(c(0,-m/2))),s,this.tileInfo,r,h,this.mirror)}}else tt(o,s,this.tileInfo,r,h,this.mirror);this.additive&&ti(),t===1&&(this.color=r,this.size=s,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}let U,a,Es=!0,re,oe,ct,Jt,Gt,yt,Be,Pe,N,ae,z;const qt=5e5,Ue=11,mi=Ue*4,As=qt/mi|0,Ne=3,yi=Ne*4,Cs=qt/yi|0;function Rs(){if(!K||ki)return;if(U=document.createElement("canvas"),a=U.getContext("webgl2",{antialias:Es}),!a){console.warn("WebGL2 not supported, falling back to 2D canvas rendering!"),U=a=void 0,K=!1;return}C.parentElement.appendChild(U),re=ni(`#version 300 es
precision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}`,`#version 300 es
precision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}`),oe=ni(`#version 300 es
precision highp float;uniform mat4 m;in vec2 p;in vec4 c;out vec4 d;void main(){gl_Position=m*vec4(p,1,1);d=c;}`,`#version 300 es
precision highp float;in vec4 d;out vec4 c;void main(){c=d;}`);const t=new ArrayBuffer(qt);N=new Float32Array(t),ae=new Uint32Array(t),Be=a.createBuffer(),Pe=a.createBuffer();const e=new Float32Array([z=0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,Pe),a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW)}function xi(){if(!ct)return;Bt(),ct=!1,a.useProgram(re);let i=0;const t=(e,s,n,r)=>{const o=a.getAttribLocation(re,e),h=n&&mi,d=n&&1,u=n===1;a.enableVertexAttribArray(o),a.vertexAttribPointer(o,r,s,u,h,i),a.vertexAttribDivisor(o,d),i+=r*n};a.bindBuffer(a.ARRAY_BUFFER,Pe),t("g",a.FLOAT,0,2),a.bindBuffer(a.ARRAY_BUFFER,Be),a.bufferData(a.ARRAY_BUFFER,qt,a.DYNAMIC_DRAW),t("p",a.FLOAT,4,4),t("u",a.FLOAT,4,4),t("c",a.UNSIGNED_BYTE,1,4),t("a",a.UNSIGNED_BYTE,1,4),t("r",a.FLOAT,4,1)}function Ps(){if(ct)return;Bt(),ct=!0,a.useProgram(oe);let i=0;const t=(e,s,n,r)=>{const o=a.getAttribLocation(oe,e),h=n===1,d=yi;a.enableVertexAttribArray(o),a.vertexAttribPointer(o,r,s,h,d,i),a.vertexAttribDivisor(o,0),i+=r*n};a.bindBuffer(a.ARRAY_BUFFER,Be),a.bufferData(a.ARRAY_BUFFER,qt,a.DYNAMIC_DRAW),t("p",a.FLOAT,4,2),t("c",a.UNSIGNED_BYTE,1,4)}function ii(){if(!K||!a)return;Ds();const i=c(2*L).divide(V),t=bt.rotate(-Yt),e=c(-1).subtract(t.multiply(i)),s=Math.cos(Yt),n=Math.sin(Yt),r=[i.x*s,i.y*n,0,0,-i.x*n,i.y*s,0,0,1,1,1,0,e.x,e.y,0,1],o=(h,d,u)=>{a.useProgram(h);const l=a.getUniformLocation(h,d);a.uniformMatrix4fv(l,!1,u)};o(oe,"m",r),o(re,"m",r),a.activeTexture(a.TEXTURE0),Ft[0]&&(yt=Ft[0].glTexture,a.bindTexture(a.TEXTURE_2D,yt)),Jt=Gt=!1,ct=!0,xi()}function Ds(){a&&(U.width=Ee.width,U.height=Ee.height,a.viewport(0,0,U.width,U.height),a.clear(a.COLOR_BUFFER_BIT))}function Is(i,t=!1){if(!a||i===yt)return;Bt(),yt=i,a.bindTexture(a.TEXTURE_2D,yt);const e=t?a.REPEAT:a.CLAMP_TO_EDGE;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,e)}function si(i,t){if(!a)return;const e=a.createShader(t);return a.shaderSource(e,i),a.compileShader(e),e}function ni(i,t){if(!a)return;const e=a.createProgram();return a.attachShader(e,si(i,a.VERTEX_SHADER)),a.attachShader(e,si(t,a.FRAGMENT_SHADER)),a.linkProgram(e),e}function Os(i){if(!a)return;const t=a.createTexture();let e=!1;if(i&&i.width)Ls(t,i),a.bindTexture(a.TEXTURE_2D,t),e=!1;else{const r=new Uint8Array([255,255,255,255]);a.bindTexture(a.TEXTURE_2D,t),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,r)}const s=a.NEAREST,n=e?a.LINEAR_MIPMAP_LINEAR:s;return a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,n),e&&a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,yt),t}function Ls(i,t){a&&(t&&t.width>0,a.bindTexture(a.TEXTURE_2D,i),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t),a.bindTexture(a.TEXTURE_2D,yt))}function Bt(){if(K&&a&&z){const i=Gt?a.ONE:a.ONE_MINUS_SRC_ALPHA;a.blendFuncSeparate(a.SRC_ALPHA,i,a.ONE,i),a.enable(a.BLEND);const t=z*(ct?Ne:Ue);a.bufferSubData(a.ARRAY_BUFFER,0,N,0,t),ct?a.drawArrays(a.TRIANGLE_STRIP,0,z):a.drawArraysInstanced(a.TRIANGLE_STRIP,0,4,z),z=0}Gt=Jt}function xe(i,t,e,s,n=0,r=0,o=0,h=1,d=1,u=-1,l=0){(z>=As||Gt!==Jt)&&Bt(),xi(),ct=!1;let m=z++*Ue;N[m++]=i,N[m++]=t,N[m++]=e,N[m++]=s,N[m++]=r,N[m++]=o,N[m++]=h,N[m++]=d,ae[m++]=u,ae[m++]=l,N[m++]=n}function bi(i,t,e,s,n,r,o,h=!0){const d=[];for(const l of i){const m=l.x*n,p=l.y*r,g=Math.sin(-o),f=Math.cos(-o);d.push(c(e+f*m-g*p,s+g*m+f*p))}const u=h?Bs(d):d;js(u,t)}function Ms(i,t,e,s,n,r,o,h,d=!0){const u=Fs(i,e,d);bi(u,t,s,n,r,o,h,!1)}function js(i,t){if(!K||i.length<3)return;const e=i.length+2;(z+e>=Cs||Gt!==Jt)&&Bt(),Ps();let s=z*Ne;for(let n=e;n--;){const r=P(n-1,0,e-3),o=i[r];N[s++]=o.x,N[s++]=o.y,ae[s++]=t}z+=e}function Fs(i,t,e=!0){if(i.length<2)return[];const s=t/2,n=[],r=i.length,o=1e-6,h=t*100;for(let d=0;d<r;d++){const u=i[e?(d-1+r)%r:Rt(d-1,0)],l=i[d],m=i[e?(d+1)%r:pt(d+1,r-1)],p=l.x-u.x,g=l.y-u.y,f=(p*p+g*g)**.5,y=m.x-l.x,x=m.y-l.y,v=(y*y+x*x)**.5;if(f<o&&v<o)continue;const S=f>o?-g/f:0,w=f>o?p/f:0,D=v>o?-x/v:0,T=v>o?y/v:0;let E=S+D,A=w+T;const Y=(E*E+A*A)**.5;if(Y<o)E=S,A=w;else{E/=Y,A/=Y;const wt=S*E+w*A;if(wt>o){const ut=pt(1/wt,h);E*=ut,A*=ut}}const Ut=c(l.x-E*s,l.y-A*s),Nt=c(l.x+E*s,l.y+A*s);n.push(Ut),n.push(Nt)}return n.length>1&&e&&(n.push(n[0]),n.push(n[1])),n}function Bs(i){if(i.length<3)return[];const t=(g,f,y)=>(f.x-g.x)*(y.y-g.y)-(f.y-g.y)*(y.x-g.x);(g=>{let f=0;for(let y=g.length;y--;){const x=(y+1)%g.length;f+=g[y].cross(g[x])}return f})(i)<0&&(i=i.reverse());const s=1e-9,n=(g,f,y,x)=>{const v=t(f,y,g),S=t(y,x,g),w=t(x,f,g),D=(v<-s?1:0)+(S<-s?1:0)+(w<-s?1:0),T=(v>s?1:0)+(S>s?1:0)+(w>s?1:0);return!(D&&T)},r=[];for(let g=0;g<i.length;++g)r[g]=g;const o=[];let h=0;const d=i.length**2+100;for(;r.length>3&&h++<d;){let g=!1;for(let f=0;f<r.length;f++){const y=r[(f+r.length-1)%r.length],x=r[f],v=r[(f+1)%r.length],S=i[y],w=i[x],D=i[v];if(t(S,w,D)<s)continue;let T=!1;for(let E=0;E<r.length;E++){const A=r[E];if(A===y||A===x||A===v)continue;const Y=i[A];if(T=n(Y,S,w,D),T)break}if(!T){o.push([y,x,v]),r.splice(f,1),g=!0;break}}if(!g){let f=-1,y=1/0;for(let w=0;w<r.length;w++){const D=r[(w+r.length-1)%r.length],T=r[w],E=r[(w+1)%r.length],A=X(t(i[D],i[T],i[E]));A<y&&(y=A,f=w)}if(f<0)break;const x=r[(f+r.length-1)%r.length],v=r[f],S=r[(f+1)%r.length];o.push([x,v,S]),r.splice(f,1)}}if(r.length===3&&o.push([r[0],r[1],r[2]]),!o.length)return[];const u=[];let[l,m,p]=o[0];u.push(i[l],i[m],i[p]);for(let g=1;g<o.length;g++){const[f,y,x]=o[g];u.push(i[p],i[f]),u.push(i[f],i[y],i[x]),p=x}return u}let b;class Us{constructor(t=nt){b=this,this.defaultColor=vt,this.defaultLineColor=ht,this.defaultTextColor=ht,this.defaultButtonColor=G(0,0,.7),this.defaultHoverColor=G(0,0,.9),this.defaultDisabledColor=G(0,0,.3),this.defaultLineWidth=4,this.defaultCornerRadius=0,this.defaultTextScale=.8,this.defaultFont="arial",this.defaultSoundPress=void 0,this.defaultSoundRelease=void 0,this.defaultSoundClick=void 0,this.uiObjects=[],this.uiContext=t,this.hoverObject=void 0,this.activeObject=void 0,Oi(e,s);function e(){function n(o){for(const h of o.children)n(h);o.updateInvisible()}function r(o){if(o.visible){o.parent&&(o.pos=o.localPos.add(o.parent.pos));for(let h=o.children.length;h--;)r(o.children[h]);o.update()}else n(o)}b.hoverObject=void 0;for(let o=b.uiObjects.length;o--;){const h=b.uiObjects[o];h.parent||r(h)}}function s(){function n(r){if(r.visible){r.parent&&(r.pos=r.localPos.add(r.parent.pos)),r.render();for(const o of r.children)n(o)}}b.uiObjects.forEach(r=>r.parent||n(r))}}drawRect(t,e,s=b.defaultColor,n=b.defaultLineWidth,r=b.defaultLineColor,o=b.defaultCornerRadius){const h=b.uiContext;h.fillStyle=s.toString(),h.beginPath(),o&&h.roundRect?h.roundRect(t.x-e.x/2,t.y-e.y/2,e.x,e.y,o):h.rect(t.x-e.x/2,t.y-e.y/2,e.x,e.y),h.fill(),n&&(h.strokeStyle=r.toString(),h.lineWidth=n,h.stroke())}drawLine(t,e,s=b.defaultLineWidth,n=b.defaultLineColor){const r=b.uiContext;r.strokeStyle=n.toString(),r.lineWidth=s,r.beginPath(),r.lineTo(t.x,t.y),r.lineTo(e.x,e.y),r.stroke()}drawTile(t,e,s,n=b.defaultColor,r=0,o=!1){tt(t,e,s,n,r,o,ci,!1,!0,b.uiContext)}drawText(t,e,s,n=b.defaultColor,r=b.defaultLineWidth,o=b.defaultLineColor,h="center",d=b.defaultFont,u=!0){rs(t,e,s.y,n,r,o,h,d,u?s.x:void 0,b.uiContext)}}class ke{constructor(t=c(),e=c()){this.localPos=t.copy(),this.pos=t.copy(),this.size=e.copy(),this.color=b.defaultColor,this.activeColor=void 0,this.text=void 0,this.disabledColor=b.defaultDisabledColor,this.disabled=!1,this.textColor=b.defaultTextColor,this.hoverColor=b.defaultHoverColor,this.lineColor=b.defaultLineColor,this.lineWidth=b.defaultLineWidth,this.cornerRadius=b.defaultCornerRadius,this.font=b.defaultFont,this.textWidth=void 0,this.textHeight=void 0,this.textScale=b.defaultTextScale,this.visible=!0,this.children=[],this.parent=void 0,this.extraTouchSize=0,this.soundPress=b.defaultSoundPress,this.soundRelease=b.defaultSoundRelease,this.soundClick=b.defaultSoundClick,this.interactive=!1,this.dragActivate=!1,b.uiObjects.push(this)}addChild(t){!t.parent&&this.children.includes(t),this.children.push(t),t.parent=this}removeChild(t){t.parent===this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=void 0}update(){const t=this.isHoverObject(),e=this.isActiveObject(),s=pi(0),n=this.dragActivate?s:cs(0);if(!b.hoverObject&&(n||e||!s&&!It)){const r=this.size.add(c(It&&this.extraTouchSize||0));Se(this.pos,r,at)&&(b.hoverObject=this)}this.isHoverObject()&&(n&&hs(0,0,0,1,0),this.disabled||(n&&this.interactive&&(this.onPress(),this.soundPress&&this.soundPress.play(),b.activeObject&&!e&&b.activeObject.onRelease(),b.activeObject=this),!s&&b.activeObject===this&&this.interactive&&(this.onClick(),this.soundClick&&this.soundClick.play()))),e&&(!s||this.dragActivate&&!this.isHoverObject())&&(this.onRelease(),this.soundRelease&&this.soundRelease.play(),b.activeObject=void 0),this.isHoverObject()!==t&&(this.isHoverObject()?this.onEnter():this.onLeave())}render(){if(!this.size.x||!this.size.y)return;const t=this.interactive&&this.isActiveObject()&&!this.disabled?this.color:this.lineColor,e=this.interactive?this.disabled?this.disabledColor:this.isActiveObject()?this.activeColor||this.color:this.isHoverObject()?this.hoverColor:this.color:this.color;b.drawRect(this.pos,this.size,e,this.lineWidth,t,this.cornerRadius)}updateInvisible(){this.isActiveObject()&&(b.activeObject=void 0)}getTextSize(){return c(this.textWidth||this.textScale*this.size.x,this.textHeight||this.textScale*this.size.y)}isHoverObject(){return b.hoverObject===this}isActiveObject(){return b.activeObject===this}onEnter(){}onLeave(){}onPress(){}onRelease(){}onClick(){}onChange(){}}class Ns extends ke{constructor(t,e,s="",n="center",r=b.defaultFont){super(t,e),this.text=s,this.align=n,this.font=r,this.lineWidth=0}render(){const t=this.getTextSize();b.drawText(this.text,this.pos,t,this.textColor,this.lineWidth,this.lineColor,this.align,this.font)}}class be extends ke{constructor(t,e,s="",n=b.defaultButtonColor){super(t,e),this.text=s,this.color=n,this.interactive=!0}render(){super.render();const t=this.getTextSize();b.drawText(this.text,this.pos,t,this.textColor,0,void 0,this.align,this.font)}}const Z={baseEnemiesToSpawn:5,baseDamage:25,baseRange:15,baseFireRate:.5,baseProjectilesPerShot:1,baseProjectileSpeed:.5,baseBugSpeed:.1,basePlayerSpeed:.25,playerDamageCooldown:2,projectileColor:G(.175,.64,.6)},xt={shoot:new et([1.1,,256,,.03,.01,1,2.4,,,-109,.26,.08,.3,8.7,,,.91,,.02]),explosion:new et([,,90,,.01,.03,4,,,,,,,9,50,.2,,.2,2]),playerHit:new et([2.6,,118,.02,,.07,2,3.9,,,,,,.9,37,.2,.07,.9,.04,,-2500]),bugHit:new et([1.3,,830,.02,.02,.03,,.3,,,-25,,.02,,18,.2,.01,.92,.02,.02]),bugKilled:new et([2,,326,.02,.07,.02,4,,,,,,,1.9,,.1,.14,.67,.05,,99]),powerup:new et([.8,,560,.07,.16,.13,5,1.2045952224567127,,-36,,,,,,,.18,.79,.14,,-1500]),upgrade:new et([,,404,.05,.23,.39,1,2,,130,,,,,12,,,.52,.24,,-799]),bombPickup:new et([1.2,,200,.01,.06,.07,4,,,-3,,,1,1,,.2,.09,.86,.58,,1665]),shovelPickup:new et([2,,446,.02,.1,.19,,1.1,,,,,,1.8,,.4,,.88,.02,,-2204])};class Ct extends St{constructor(t,e){super(t,e),this.setCollision(),this.mass=0}}const ks=3;class ce extends St{timeSinceDrop;constructor(t,e){super(t,e),this.setCollision(!0,!1,!1,!1),this.timeSinceDrop=0}update(){super.update(),this.timeSinceDrop+=Mt,this.timeSinceDrop>=ks&&this.destroy()}}class vi extends ce{render(){tt(this.pos,c(2),he(0,c(16,16),2))}}class Si extends ce{render(){tt(this.pos,c(2),he(0,c(16,16),3))}}class _e extends St{startPos;damage;range;constructor(t,e,s,n,r,o,h){super(t,c(e)),this.startPos=t,this.damage=n,this.range=r,this.color=h,this.velocity=s.subtract(t).normalize(o),this.setCollision()}update(){super.update(),Math.sqrt(Math.pow(this.pos.x-this.startPos.x,2)+Math.pow(this.pos.y-this.startPos.y,2))>this.range&&this.destroy()}render(){ns(this.pos,this.size.x,this.color)}collideWithObject(t){return!(t instanceof Ct||t instanceof ce)}}class wi extends St{targetPosition;health;speed;powerupOptions=[vi,Si];constructor(t,e,s){super(t,e),this.setCollision(),this.speed=s,this.targetPosition=c(0,0),this.health=100}update(){super.update();const t=Math.sqrt(Math.pow(this.targetPosition.x-this.pos.x,2)+Math.pow(this.targetPosition.y-this.pos.y,2));let e=Math.min(t,25),s=this.targetPosition.x+_(e)*we()-this.pos.x,n=this.targetPosition.y+_(e)*we()-this.pos.y,r=c(s,n).normalize(1).scale(this.speed);this.velocity=r,this.angle=-Math.atan2(this.pos.y-this.targetPosition.y,this.pos.x-this.targetPosition.x)+Math.PI/2}render(){tt(this.pos,c(2,2.5),he(0,c(60,80),0,15),void 0,this.angle)}hitEffect(){new ws(this.pos,void 0,1,.1,100,Math.PI,void 0,G(0,1,.6),G(0,1,.6),G(0,1,.6),G(0,1,.6),void 0,.25,0)}hit(t){if(xt.bugHit.play(),this.health-=t,this.hitEffect(),this.health<=0){if(xt.bugKilled.play(),O(0,1)<.1){const e=this.powerupOptions[_(this.powerupOptions.length)];new e(this.pos,c(1))}this.kill()}}kill(){this.hitEffect(),this.destroy()}collideWithObject(t){return t instanceof Ct||t instanceof ce?!1:(t instanceof _e&&(this.hit(t.damage),t.destroy()),!0)}}class _s extends St{moveDirection;weapon;health;speed;recoverTimer;eventBus;constructor(t,e,s,n){super(t,e),this.weapon=s,this.eventBus=n,this.moveDirection=c(0),this.tileInfo=he(0,c(51,43),1),this.health=3,this.recoverTimer=new Ui(0),this.speed=Z.basePlayerSpeed,this.setCollision()}update(){super.update(),this.moveDirection=this.moveDirection.clampLength(1).scale(this.speed),this.velocity=this.moveDirection,this.angle=-Math.atan2(this.pos.y-ne.y,this.pos.x-ne.x)+Math.PI,this.weapon.timeSinceLastShot+=Mt}fire(t){this.weapon.fire(this.pos,t)}render(){this.recoverTimer.elapsed()?tt(this.pos,this.size,this.tileInfo,void 0,this.angle):tt(this.pos,this.size,this.tileInfo,G(1,1,1,.5),this.angle)}collideWithObject(t){if(t instanceof _e)return!1;if(t instanceof wi&&this.recoverTimer.elapsed()&&(xt.playerHit.play(),this.health--,this.recoverTimer.set(Z.playerDamageCooldown)),t instanceof vi){const e=new CustomEvent("bomb");this.eventBus.dispatchEvent(e),xt.bombPickup.play(),t.destroy()}if(t instanceof Si){const e=new CustomEvent("shovel");this.eventBus.dispatchEvent(e),xt.shovelPickup.play(),t.destroy()}return!0}}class Ys{damage;range;fireRate;projectilesPerShot;timeSinceLastShot;projectileSpeed;projectileColor;constructor(t,e,s,n,r,o){this.damage=t,this.range=e,this.fireRate=s,this.projectilesPerShot=n,this.projectileSpeed=r,this.projectileColor=o,this.timeSinceLastShot=100}fire(t,e){this.timeSinceLastShot+=Mt;let s=e.copy();if(this.timeSinceLastShot>=this.fireRate){xt.shoot.play();for(let n=0;n<this.projectilesPerShot;n++)n>0&&(s=s.copy().rotate(O(.2)*(_(2)===0?1:-1))),new _e(t,this.damage/100,s,this.damage,this.range,this.projectileSpeed,this.projectileColor);this.timeSinceLastShot=0}}}const ri=[{displayName:"damage up",upgradeFunc:i=>i.damage+=10},{displayName:"fire rate up",upgradeFunc:i=>i.fireRate-=.05},{displayName:"range up",upgradeFunc:i=>i.range+=10},{displayName:"shot speed up",upgradeFunc:i=>i.projectileSpeed+=.1},{displayName:"more bullets",upgradeFunc:i=>i.projectilesPerShot++}],Ws=G(1.27,.51,.17);let H,$=[],Ye=new EventTarget,ie=!1,Ot=0,Vt=0,ue=!1,se=0,Xs=.25,st,Wt,Xt,zt,Lt="",Kt=0;const it=new as;function Ti(){return Ot*Z.baseEnemiesToSpawn}function zs(i){for(let t=0;t<i;t++){let e,s;_(2)===0?(e=_(j.x/L/2)*(_(2)===0?-1:1),s=j.y/L/2*(_(2)===0?-1:1)):(e=j.x/L/2*(_(2)===0?-1:1),s=_(j.y/L/2)*(_(2)===0?-1:1)),$.push(new wi(c(e,s),c(.75,1),Z.baseBugSpeed))}}function We(){st.visible=!1,ue=!0,Vt=0,Ot++;const i=[];for(;i.length<3;){const e=ri[Math.floor(Math.random()*ri.length)];i.includes(e)||i.push(e)}const t=(e,s)=>{xt.upgrade.play(),s(e),We()};Wt.text=i[0].displayName,Xt.text=i[1].displayName,zt.text=i[2].displayName,Wt.onClick=()=>t(H.weapon,i[0].upgradeFunc),Xt.onClick=()=>t(H.weapon,i[1].upgradeFunc),zt.onClick=()=>t(H.weapon,i[2].upgradeFunc)}function Ei(){H=new _s(bt,c(2,1.5),new Ys(Z.baseDamage,Z.baseRange,Z.baseFireRate,Z.baseProjectilesPerShot,Z.baseProjectileSpeed,Z.projectileColor),Ye)}function Hs(){$.forEach(i=>i.destroy()),$=[],Ei(),Ot=0,Vt=0,ue=!1,se=0,We()}Ye.addEventListener("bomb",()=>{Lt="Bug Bomb",Kt=0,$.forEach(i=>i.kill())});Ye.addEventListener("shovel",()=>{Lt="Dig Their Graves",Kt=0,$.forEach(i=>i.hit(i.health/2))});function Gs(){Qi(c(1920,1080)),qi(Ws),new Ct(c(0,j.y/L/2+1),c(j.x/L,2)),new Ct(c(0,-(j.y/L/2)-1),c(j.x/L,2)),new Ct(c(-(j.x/L/2)-1,0),c(2,j.y/L)),new Ct(c(j.x/L/2+1,0),c(2,j.y/L)),Ei(),new Us,b.defaultCornerRadius=5,st=new ke(V.scale(.5),c(600,450)),st.addChild(new Ns(c(0,-120),c(400,50),"Choose an upgrade")),Wt=new be(c(0,-10),c(300,50)),Wt.textHeight=30,st.addChild(Wt),Xt=new be(c(0,50),c(300,50)),Xt.textHeight=30,st.addChild(Xt),zt=new be(c(0,110),c(300,50)),zt.textHeight=30,st.addChild(zt),st.visible=!1}function Vs(){if(!ie){Ce("Space")&&(ie=!0,We());return}if(H.health<=0){H.destroy(),Ce("Space")&&Hs();return}if(Lt!==""&&(Kt+=Mt),ie&&ue){if(se+=Mt,se>=Xs&&Vt<Ti()){let i=2;zs(i),Vt+=i,se=0}pi(0)&&H.fire(ne),H.moveDirection=ls();for(let i=$.length-1;i>=0;i--)$[i].destroyed&&$.splice(i,1);$.forEach(i=>i.targetPosition=H.pos)}}function Ks(){}function Js(){}function qs(){const i=V.scale(.5);if(!ie){ts(c(0,-3),c(30,10),G(0,0,0)),it.drawTextScreen("Press space to start",i,5,!0),it.drawTextScreen("WASD to move",c(i.x,i.y+100),3,!0),it.drawTextScreen("Point and click to shoot",c(i.x,i.y+150),3,!0);return}H.health<=0&&(it.drawTextScreen("Game Over",i,6,!0),it.drawTextScreen(`You survived until wave ${Ot}`,c(i.x,i.y+100),3,!0),it.drawTextScreen("Press space to restart",c(i.x,i.y+150),3,!0)),Lt!==""&&(Kt<=2?it.drawTextScreen(Lt,c(i.x,i.y/3),5,!0):(Kt=0,Lt="")),it.drawTextScreen(`Wave ${Ot}`,c(20,40),3),it.drawTextScreen(`Health ${H.health}`,c(20,90),3),Ot>0&&$.length===0&&Vt>=Ti()&&(ue=!1,st.pos=i,st.visible=!0)}Li(Gs,Vs,Ks,Js,qs,["Ants.png","survivor1_machine.png","items/bomb.png","items/shovel.png"]);
