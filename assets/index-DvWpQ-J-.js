(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const pe=60,ne=1/pe;let dt=[],ti=[],Ti=0,Q=0,ze=0,J=0;const ei=[],ii=[];function Ai(i,t){i&&ei.push(i),t&&ii.push(t)}async function Ei(i,t,e,s,n,r=[],o=document.body){i||=()=>{},t||=()=>{},e||=()=>{},s||=()=>{},n||=()=>{};function h(){V=c(C.width,C.height),tt.imageSmoothingEnabled=ct.imageSmoothingEnabled=!1,qe()}function d(f=0){let y=f-ze;ze=f,J+=y,J=gt(J,50);let x=!1;{let v=0;for(J<0&&J>-9&&(v=J,J=0);J>=0;J-=1e3/pe)Q=Ti++/pe,x=!0,u(),ns(),t(),ei.forEach(w=>w()),Ci(),e(),rs();J+=v}S(),requestAnimationFrame(d);function S(){x||u(),h(),s(),dt.sort((v,w)=>v.renderOrder-w.renderOrder);for(const v of dt)v.destroyed||v.render();n(),ii.forEach(v=>v()),Ot()}}function u(){if(M.x){C.width=M.x,C.height=M.y;const x=innerWidth/innerHeight,S=C.width/C.height;(U||C).style.width=C.style.width=q.style.width=x<S?"100%":"",(U||C).style.height=C.style.height=q.style.height=x<S?"":"100%"}else C.width=gt(innerWidth,Ge.x),C.height=gt(innerHeight,Ge.y);xe.a>0&&(ct.fillStyle=xe.toString(),ct.fillRect(0,0,V.x,V.y),ct.fillStyle=at.toString()),q.width=C.width,q.height=C.height,V=c(C.width,C.height);const f="round",y="round";ct.lineJoin=tt.lineJoin=f,ct.lineCap=tt.lineCap=y}async function l(){await i(),d()}const m="margin:0;overflow:hidden;background:#000;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none";o.style.cssText=m,be=C=document.createElement("canvas"),o.appendChild(C),re=ct=C.getContext("2d"),os(),hs(),Ss(),q=document.createElement("canvas"),o.appendChild(q),tt=q.getContext("2d");const p="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";C.style.cssText=q.style.cssText=p,U&&(U.style.cssText=p),Hi(ri),Gi(oi),u(),qe(),Tt=new OffscreenCanvas(256,256),Ft=Tt.getContext("2d",{willReadFrequently:!0});const g=r.map((f,y)=>new Promise(x=>{const S=new Image;S.onerror=S.onload=()=>{const v=new Se(S);v.createWebGLTexture(),It[y]=v,x()},S.crossOrigin="anonymous",S.src=f}));return r.length||g.push(new Promise(f=>{const y=new Se(new Image);It[0]=y,y.createWebGLTexture(),f()})),await Promise.all(g),l()}function Ci(){ti=dt.filter(t=>t.collideSolidObjects);function i(t){if(!t.destroyed){t.update();for(const e of t.children)i(e)}}for(const t of dt)t.parent||(i(t),t.updateTransforms());dt=dt.filter(t=>!t.destroyed)}const Wt=Math.PI;function X(i){return Math.abs(i)}function gt(...i){return Math.min(...i)}function At(...i){return Math.max(...i)}function Et(i){return Math.sign(i)}function Ct(i,t=1){return(i%t+t)%t}function P(i,t=0,e=1){return i<t?t:i>e?e:i}function Dt(i,t,e){return(e-=t)?P((i-t)/e):0}function Kt(i,t,e){return i>=0&&i<=1&&(t<0||t>1)&&(e<0||e>1)&&console.warn("lerp() parameter order changed! use lerp(start, end, p)"),i+P(e)*(t-i)}function me(i,t,e,s=c()){const n=(i.x-e.x)*2,r=(i.y-e.y)*2,o=t.x+s.x,h=t.y+s.y;return n>=-o&&n<o&&r>=-h&&r<h}function wt(i){return typeof i=="number"&&!isNaN(i)}function O(i=1,t=0){return t+Math.random()*(i-t)}function Y(i,t=0){return Math.floor(O(i,t))}function Ri(i=.5){return O()<i}function ye(){return Y(2)*2-1}function si(i=1){return new R().setAngle(O(2*Wt),i)}function Pi(i=1,t=0){return i>0?si(i*O(t/i,1)**.5):new R}function He(i=new I,t=new I(0,0,0,1),e=!1){return e?i.lerp(t,O()):new I(O(i.r,t.r),O(i.g,t.g),O(i.b,t.b),O(i.a,t.a))}function c(i=0,t){return new R(i,t===void 0?i:t)}function et(i){return i instanceof R&&i.isValid()}function Di(i){et(i)}class R{constructor(t=0,e=0){this.x=t,this.y=e,this.isValid()}set(t=0,e=0){return this.x=t,this.y=e,this}copy(){return new R(this.x,this.y)}add(t){return new R(this.x+t.x,this.y+t.y)}subtract(t){return new R(this.x-t.x,this.y-t.y)}multiply(t){return new R(this.x*t.x,this.y*t.y)}divide(t){return new R(this.x/t.x,this.y/t.y)}scale(t){return new R(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new R(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}reflect(t,e=1){return this.subtract(t.scale((1+e)*this.dot(t)))}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(-t),s=Math.sin(-t);return new R(this.x*e-this.y*s,this.x*s+this.y*e)}setDirection(t,e=1){return t=Ct(t,4),c(t%2?t-1?-e:e:0,t%2?0:t?-e:e)}direction(){return X(this.x)>X(this.y)?this.x<0?3:1:this.y<0?2:0}abs(){return new R(X(this.x),X(this.y))}floor(){return new R(Math.floor(this.x),Math.floor(this.y))}mod(t=1){return new R(Ct(this.x,t),Ct(this.y,t))}area(){return X(this.x*this.y)}lerp(t,e){Di(t);const s=P(e);return new R(t.x*s+this.x*(1-s),t.y*s+this.y*(1-s))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return this.isValid()?`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`:`(${this.x}, ${this.y})`}isValid(){return wt(this.x)&&wt(this.y)}}function _(i,t,e,s){return new I(i,t,e,s)}function G(i,t,e,s){return new I().setHSLA(i,t,e,s)}function ot(i){return i instanceof I&&i.isValid()}function ce(i){ot(i)}class I{constructor(t=1,e=1,s=1,n=1){this.r=t,this.g=e,this.b=s,this.a=n,this.isValid()}set(t=1,e=1,s=1,n=1){return this.r=t,this.g=e,this.b=s,this.a=n,this}copy(){return new I(this.r,this.g,this.b,this.a)}add(t){return new I(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new I(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new I(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new I(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new I(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new I(P(this.r),P(this.g),P(this.b),P(this.a))}lerp(t,e){ce(t);const s=P(e);return new I(t.r*s+this.r*(1-s),t.g*s+this.g*(1-s),t.b*s+this.b*(1-s),t.a*s+this.a*(1-s))}setHSLA(t=0,e=0,s=1,n=1){t=Ct(t,1),e=P(e),s=P(s);const r=s<.5?s*(1+e):s+e-s*e,o=2*s-r,h=(d,u,l)=>(l=Ct(l,1))*6<1?d+(u-d)*6*l:l*2<1?u:l*3<2?d+(u-d)*(4-l*6):d;return this.r=h(o,r,t+1/3),this.g=h(o,r,t),this.b=h(o,r,t-1/3),this.a=n,ce(this),this}HSLA(){const t=P(this.r),e=P(this.g),s=P(this.b),n=P(this.a),r=At(t,e,s),o=gt(t,e,s),h=(r+o)/2;let d=0,u=0;if(r!==o){let l=r-o;u=h>.5?l/(2-r-o):l/(r+o),t===r?d=(e-s)/l+(e<s?6:0):e===r?d=(s-t)/l+2:s===r&&(d=(t-e)/l+4)}return[d/6,u,h,n]}mutate(t=.05,e=0){return new I(this.r+O(t,-t),this.g+O(t,-t),this.b+O(t,-t),this.a+O(e,-e)).clamp()}toString(t=!0){const e=s=>((s=P(s)*255|0)<16?"0":"")+s.toString(16);return"#"+e(this.r)+e(this.g)+e(this.b)+(t?e(this.a):"")}setHex(t){if(typeof t=="string"&&t[0],[4,5,7,9].includes(t.length),t.length<6){const e=s=>P(parseInt(t[s],16)/15);this.r=e(1),this.g=e(2),this.b=e(3),this.a=t.length===5?e(4):1}else{const e=s=>P(parseInt(t.slice(s,s+2),16)/255);this.r=e(1),this.g=e(3),this.b=e(5),this.a=t.length===9?e(7):1}return ce(this),this}rgbaInt(){const t=P(this.r)*255|0,e=P(this.g)*255<<8,s=P(this.b)*255<<16,n=P(this.a)*255<<24;return t+e+s+n}isValid(){return wt(this.r)&&wt(this.g)&&wt(this.b)&&wt(this.a)}}const xt=_();_(1,1,1,0);const at=_(0,0,0),ni=_(0,0,0,0);_(.5,.5,.5);_(1,0,0);_(1,.5,0);_(1,1,0);_(0,1,0);_(0,1,1);_(0,0,1);_(.5,0,1);_(1,0,1);class Ii{constructor(t){this.time=t===void 0?void 0:Q+t,this.setTime=t}set(t=0){this.time=Q+t,this.setTime=t}unset(){this.time=void 0}isSet(){return this.time!==void 0}active(){return Q<this.time}elapsed(){return Q>=this.time}get(){return this.isSet()?Q-this.time:0}getPercent(){return this.isSet()?1-Dt(this.time-Q,0,this.setTime):0}getSetTime(){return this.isSet()?this.setTime:0}toString(){return this.isSet()?Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after"):"unset"}valueOf(){return this.get()}}let yt=c(),Ut=0,L=32,xe=ni,Ge=c(1920,1080),M=c(),ri=!0,oi=!1,Oi="arial",Li=!1,K=!0,ji=32,ai=c(16),Mi=0,Fi=1,Bi=1,Ui=1,Ni=0,_i=.8,ft=1,ue=c(),Ve=1,de=!0,ki=.3,Wi=40,Yi=.7;c(640,80);function Xi(i){xe=i}function zi(i){M=i}function Hi(i){ri=i,C&&(C.style.imageRendering=i?"pixelated":""),U&&(U.style.imageRendering=i?"pixelated":"")}function Gi(i){oi=i,q&&(q.style.imageRendering=i?"pixelated":"")}class bt{constructor(t=c(),e=c(1),s,n=0,r=new I,o=0){et(t),et(e),ot(r),this.pos=t.copy(),this.size=e.copy(),this.drawSize=void 0,this.tileInfo=s,this.angle=n,this.color=r.copy(),this.additiveColor=void 0,this.mirror=!1,this.mass=Fi,this.damping=Bi,this.angleDamping=Ui,this.restitution=Ni,this.friction=_i,this.gravityScale=1,this.renderOrder=o,this.velocity=c(),this.angleVelocity=0,this.spawnTime=Q,this.children=[],this.clampSpeed=!0,this.groundObject=void 0,this.parent=void 0,this.localPos=c(),this.localAngle=0,this.collideTiles=!1,this.collideSolidObjects=!1,this.isSolid=!1,this.collideRaycast=!1,dt.push(this)}updateTransforms(){const t=this.parent;if(t){const e=t.getMirrorSign();this.pos=this.localPos.multiply(c(e,1)).rotate(t.angle).add(t.pos),this.angle=e*this.localAngle+t.angle}for(const e of this.children)e.updateTransforms()}update(){if(this.parent)return;this.clampSpeed&&(this.velocity.x=P(this.velocity.x,-ft,ft),this.velocity.y=P(this.velocity.y,-ft,ft));const t=this.pos.copy();if(this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.mass&&(this.velocity.x+=ue.x*this.gravityScale,this.velocity.y+=ue.y*this.gravityScale),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.angle+=this.angleVelocity*=this.angleDamping,this.angleDamping>=0&&this.angleDamping<=1,this.damping>=0&&this.damping<=1,!this.mass)return;const e=this.velocity.y<0;if(this.groundObject){const s=At(this.friction,this.groundObject.friction),n=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=n+(this.velocity.x-n)*s,this.groundObject=void 0}if(this.collideSolidObjects)for(const n of ti){if(!this.isSolid&&!n.isSolid||n.destroyed||n.parent||n===this||!me(this.pos,this.size,n.pos,n.size))continue;const r=this.collideWithObject(n),o=n.collideWithObject(this);if(!r||!o)continue;if(me(t,this.size,n.pos,n.size)){const p=t.subtract(n.pos),g=p.length(),f=.001,y=g<.01?si(f):p.scale(f/g);this.velocity=this.velocity.add(y),n.mass&&(n.velocity=n.velocity.subtract(y));continue}const h=this.size.add(n.size),d=(t.y-n.pos.y)*2>h.y+ue.y,u=X(t.y-n.pos.y)*2<h.y,l=X(t.x-n.pos.x)*2<h.x,m=At(this.restitution,n.restitution);if(d||l||!u){if(this.pos.y=n.pos.y+(h.y/2+.001)*Et(t.y-n.pos.y),n.groundObject&&e||!n.mass)e&&(this.groundObject=n),this.velocity.y*=-m;else if(n.mass){const p=(this.mass*this.velocity.y+n.mass*n.velocity.y)/(this.mass+n.mass),g=this.velocity.y*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.y*2*n.mass/(this.mass+n.mass),f=n.velocity.y*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.y*2*this.mass/(this.mass+n.mass);this.velocity.y=Kt(p,g,m),n.velocity.y=Kt(p,f,m)}}if(!d&&u)if(this.pos.x=n.pos.x+(h.x/2+.001)*Et(t.x-n.pos.x),n.mass){const p=(this.mass*this.velocity.x+n.mass*n.velocity.x)/(this.mass+n.mass),g=this.velocity.x*(this.mass-n.mass)/(this.mass+n.mass)+n.velocity.x*2*n.mass/(this.mass+n.mass),f=n.velocity.x*(n.mass-this.mass)/(this.mass+n.mass)+this.velocity.x*2*this.mass/(this.mass+n.mass);this.velocity.x=Kt(p,g,m),n.velocity.x=Kt(p,f,m)}else this.velocity.x*=-m}if(this.collideTiles){const s=qt(this.pos,this.size,this);if(s&&!qt(t,this.size,this)){const n=qt(c(t.x,this.pos.y),this.size,this),r=qt(c(this.pos.x,t.y),this.size,this);if(n||!r){const o=At(this.restitution,s.restitution);this.velocity.y*=-o,e?(this.pos.y=(t.y-this.size.y/2|0)+this.size.y/2+1e-4,this.groundObject=s):(this.pos.y=t.y,this.groundObject=void 0)}r&&(this.pos.x=t.x,this.velocity.x*=-this.restitution)}}}render(){it(this.pos,this.drawSize||this.size,this.tileInfo,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.parent=0,t.destroy()}}localToWorld(t){return this.pos.add(t.rotate(this.angle))}worldToLocal(t){return t.subtract(this.pos).rotate(-this.angle)}localToWorldVector(t){return t.rotate(this.angle)}worldToLocalVector(t){return t.rotate(-this.angle)}collideWithTile(t,e){return t>0}collideWithObject(t){return!0}getAliveTime(){return Q-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyAngularAcceleration(t){this.mass&&(this.angleVelocity+=t)}applyForce(t){this.mass&&this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,e=c(),s=0){!t.parent&&this.children.includes(t),this.children.push(t),t.parent=this,t.localPos=e.copy(),t.localAngle=s}removeChild(t){t.parent===this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=!0,e=!0,s=!0,n=!0){this.collideSolidObjects=t,this.isSolid=e,this.collideTiles=s,this.collideRaycast=n}toString(){}renderDebugInfo(){}}let C,ct,q,tt,be,re,Tt,Ft,V=c(),It=[];function Ae(i=new R,t=ai,e=0,s=0){typeof t=="number"&&(t=new R(t,t));const n=new Ee(new R,t,e,s),r=It[e],o=t.x+s*2,h=t.y+s*2;if(typeof i=="number"){const d=r.size.x/o|0,u=i%d,l=i/d|0;n.pos.set(u*o+s,l*h+s)}else n.pos.set(i.x*o+s,i.y*h+s);return n}class Ee{constructor(t=c(),e=ai,s=0,n=0,r=Mi){this.pos=t.copy(),this.size=e.copy(),this.textureIndex=s,this.padding=n,this.textureInfo=It[this.textureIndex],this.bleedScale=r}offset(t){return new Ee(this.pos.add(t),this.size,this.textureIndex,this.padding,this.bleedScale)}frame(t){return this.offset(new R(t*(this.size.x+this.padding*2),0))}setFullImage(t,e){return this.pos=new R,this.size=new R(t.width,t.height),this.textureInfo=new Se(t,e),this.bleedScale=this.padding=0,this}}class Se{constructor(t,e){this.image=t,this.size=c(t.width,t.height),this.sizeInverse=c(1/t.width,1/t.height),this.glTexture=e}createWebGLTexture(){this.glTexture,K&&(this.glTexture=As(this.image))}}function it(i,t=new R(1),e,s=xt,n=0,r,o,h=K,d,u){et(i),et(t),ot(s)&&(!o||ot(o));const l=e&&e.textureInfo,m=e?e.bleedScale:0;if(h)if(d&&(i=Re(i),t=t.scale(1/L)),l){const p=l.sizeInverse,g=e.pos.x*p.x,f=e.pos.y*p.y,y=e.size.x*p.x,x=e.size.y*p.y;if(Ts(l.glTexture),m){const S=p.x*m,v=p.y*m;fe(i.x,i.y,r?-t.x:t.x,t.y,n,g+S,f+v,g-S+y,f-v+x,s.rgbaInt(),o&&o.rgbaInt())}else fe(i.x,i.y,r?-t.x:t.x,t.y,n,g,f,g+y,f+x,s.rgbaInt(),o&&o.rgbaInt())}else fe(i.x,i.y,t.x,t.y,n,0,0,0,0,0,s.rgbaInt());else t=new R(t.x,-t.y),Ce(i,t,n,r,p=>{if(l){const g=e.pos.x,f=e.pos.y,y=e.size.x,x=e.size.y;$i(p,l.image,g,f,y,x,-.5,-.5,1,1,s,o,m)}else{const g=o?s.add(o):s;p.fillStyle=g.toString(),p.fillRect(-.5,-.5,1,1)}},d,u)}function Vi(i,t,e,s,n,r,o){it(i,t,void 0,e,s,!1,void 0,n,r,o)}function Ki(i,t=c(1),e=3,s=xt,n=0,r=at,o=0,h=K,d=!1,u){et(t);const l=[],m=t.x/2,p=t.y/2;for(let g=e;g--;){const f=g/e*Wt*2;l.push(c(Math.sin(f)*m,Math.cos(f)*p))}Ji(l,s,n,r,i,o,h,d,u)}function Ji(i,t=xt,e=0,s=at,n=c(),r=0,o=K,h=!1,d=void 0){if(et(n),ot(t)&&ot(s),o){let u=1;h&&(n=Re(n),u=1/L),fi(i,t.rgbaInt(),n.x,n.y,u,u,r),e>0&&Cs(i,s.rgbaInt(),e,n.x,n.y,u,u,r)}else Ce(n,c(1),r,!1,u=>{u.fillStyle=t.toString(),u.beginPath();for(const l of i)u.lineTo(l.x,l.y);u.closePath(),u.fill(),e&&(u.strokeStyle=s.toString(),u.lineWidth=e,u.stroke())},h,d)}function qi(i,t=c(1),e=xt,s=0,n=0,r=at,o=K,h=!1,d){et(i),et(t),ot(e)&&ot(r),n>=0&&n<t.x&&n<t.y,o?Ki(i,t,ji,e,n,r,s,o,h,d):Ce(i,c(1),s,!1,u=>{u.fillStyle=e.toString(),u.beginPath(),u.ellipse(0,0,t.x/2,t.y/2,0,0,9),u.fill(),n&&(u.strokeStyle=r.toString(),u.lineWidth=n,u.stroke())},h,d)}function Qi(i,t=1,e=xt,s=0,n=at,r=K,o=!1,h){qi(i,c(t),e,0,s,n,r,o,h)}function Ce(i,t,e=0,s=!1,n,r=!1,o=re){r||(i=Pe(i),t=t.scale(L)),o.save(),o.translate(i.x+.5,i.y+.5),o.rotate(e-Ut),o.scale(s?-t.x:t.x,-t.y),n(o),o.restore()}function Zi(i,t,e=1,s=xt,n=0,r=at,o="center",h=Oi,d,u=tt){u.fillStyle=s.toString(),u.strokeStyle=r.toString(),u.lineWidth=n,u.textAlign=o,u.font=e+"px "+h,u.textBaseline="middle";const l=(i+"").split(`
`);let m=t.y;m-=(l.length-1)*e/2,l.forEach(p=>{n&&u.strokeText(p,t.x,m,d),u.fillText(p,t.x,m,d),m+=e})}function Re(i){let t=(i.x-V.x/2+.5)/L,e=(i.y-V.y/2+.5)/-L;return new R(t+yt.x,e+yt.y)}function Pe(i){let t=i.x-yt.x,e=i.y-yt.y;return new R(t*L+V.x/2-.5,e*-L+V.y/2-.5)}function Ke(i=!1,t){Ht=i,t||=re,t.globalCompositeOperation=i?"lighter":"source-over"}function $i(i,t,e,s,n,r,o,h,d,u,l,m,p=0){function g(w){return w.r>=1&&w.g>=1&&w.b>=1}function f(w){return w.r<=0&&w.g<=0&&w.b<=0&&w.a<=0}const y=p,x=p,S=n-2*p,v=r-2*p;if(m?g(l.add(m))&&m.a<=0:g(l))i.globalAlpha=l.a,i.drawImage(t,e+y,s+x,S,v,o,h,d,u),i.globalAlpha=1;else{Tt.width=n,Tt.height=r,Ft.drawImage(t,e,s,n,r,0,0,n,r);const w=Ft.getImageData(0,0,n,r),D=w.data;if(m&&!f(m)){const T=[l.r,l.g,l.b,l.a],A=[m.r*255,m.g*255,m.b*255,m.a*255];for(let E=0;E<D.length;++E)D[E]=D[E]*T[E&3]+A[E&3]|0;Ft.putImageData(w,0,0),i.drawImage(Tt,y,x,S,v,o,h,d,u)}else{for(let T=0;T<D.length;T+=4)D[T]*=l.r,D[T+1]*=l.g,D[T+2]*=l.b;Ft.putImageData(w,0,0),i.globalAlpha=l.a,i.drawImage(Tt,y,x,S,v,o,h,d,u),i.globalAlpha=1}}}let Jt;class ts{constructor(t,e=c(8),s=c(0,1),n=tt){Jt||(Jt=new Image,Jt.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=t||Jt,this.tileSize=e,this.paddingSize=s}drawText(t,e,s=1,n,r=re){this.drawTextScreen(t,Pe(e).floor(),s*L|0,n,r)}drawTextOverlay(t,e,s=4,n){this.drawText(t,e,s,n,tt)}drawTextScreen(t,e,s=4,n,r=tt){r.save();const o=this.tileSize,h=o.add(this.paddingSize).scale(s),d=this.image.width/this.tileSize.x|0;(t+"").split(`
`).forEach((u,l)=>{const m=n?u.length*o.x*s/2|0:0;for(let p=u.length;p--;){let g=u[p].charCodeAt(0);(g<32||g>127)&&(g=127);const f=g-32,y=f%d,x=f/d|0,S=e.add(c(p,l).multiply(h));r.drawImage(this.image,y*o.x,x*o.y,o.x,o.y,S.x-m,S.y,o.x*s,o.y*s)}}),r.restore()}}function De(i,t=0){return j[t]&&!!(j[t][i]&1)}function ve(i,t=0){return j[t]&&!!(j[t][i]&2)}function es(i="ArrowUp",t="ArrowDown",e="ArrowLeft",s="ArrowRight"){const n=r=>De(r)?1:0;return c(n(s)-n(e),n(i)-n(t))}function li(){j=[[]]}function is(i,t=0,e=!0,s=!0,n=!0){j[t]&&(j[t][i]&=~((e?1:0)|(s?2:0)|(n?4:0)))}function hi(i){return De(i)}function ss(i){return ve(i)}let te=c(),rt=c();c();let pt=c();function Mt(i,t=0){return De(i,t+1)}let j=[[]];function ns(){!Rt&&!document.hasFocus()&&li(),te=Re(rt),pt.multiply(c(1,-1)).rotate(-Ut),as()}function rs(){for(const i of j)for(const t in i)i[t]&=1;c(),pt=c()}function os(){document.addEventListener("keydown",i),document.addEventListener("keyup",t),document.addEventListener("mousedown",s),document.addEventListener("mouseup",n),document.addEventListener("mousemove",r),document.addEventListener("wheel",o),document.addEventListener("contextmenu",h),document.addEventListener("blur",d),document.addEventListener("mouseleave",u),Rt&&de&&ls();function i(l){l.repeat||(j[0][l.code]=3,j[0][e(l.code)]=3)}function t(l){j[0][l.code]=j[0][l.code]&2|4,j[0][e(l.code)]=4}function e(l){return l==="KeyW"?"ArrowUp":l==="KeyS"?"ArrowDown":l==="KeyA"?"ArrowLeft":l==="KeyD"?"ArrowRight":l}function s(l){Rt&&de||(F&&!Oe()&&F.resume(),j[0][l.button]=3,rt=we(c(l.x,l.y)),l.button&&l.preventDefault())}function n(l){Rt&&de||(j[0][l.button]=j[0][l.button]&2|4)}function r(l){rt=we(c(l.x,l.y)),pt=pt.add(c(l.movementX,l.movementY))}function o(l){l.ctrlKey||Et(l.deltaY)}function h(l){l.preventDefault()}function d(){li()}function u(){rt=c(-1),pt=c(0)}}function we(i){const t=C.getBoundingClientRect(),e=Dt(i.x,t.left,t.right),s=Dt(i.y,t.top,t.bottom);return c(e*C.width,s*C.height)}const Je=[];function as(){const i=e=>{const r=o=>o>.3?Dt(o,.3,.8):o<-.3?-Dt(-o,.3,.8):0;return c(r(e.x),r(-e.y)).clampLength()};if(!navigator||!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e],n=j[e+1]||(j[e+1]=[]),r=Je[e]||(Je[e]=[]);if(s){for(let o=0;o<s.axes.length-1;o+=2)r[o>>1]=i(c(s.axes[o],s.axes[o+1]));for(let o=s.buttons.length;o--;){const h=s.buttons[o],d=Mt(o,e);n[o]=h.pressed?d?1:3:d?4:0,(!h.value||h.value>.9)&&!e&&h.pressed}{const o=c((Mt(15,e)&&1)-(Mt(14,e)&&1),(Mt(12,e)&&1)-(Mt(13,e)&&1));o.lengthSquared()&&(r[0]=o.clampLength())}}}}const Rt=window.ontouchstart!==void 0;c();function ls(){let i=e;document.addEventListener("touchstart",s=>i(s),{passive:!1}),document.addEventListener("touchmove",s=>i(s),{passive:!1}),document.addEventListener("touchend",s=>i(s),{passive:!1});let t;function e(s){F&&!Oe()&&F.resume();const n=s.touches.length,r=0;if(n){const o=c(s.touches[0].clientX,s.touches[0].clientY),h=rt;rt=we(o),t?pt=pt.add(rt.subtract(h)):j[0][r]=3}else t&&(j[0][r]=j[0][r]&2|4);return t=n,document.hasFocus()&&s.cancelable&&s.preventDefault(),!0}}let F=new AudioContext,Qt;const Ie=44100;function Oe(){return F.state==="running"}function hs(){Qt=F.createGain(),Qt.connect(F.destination),Qt.gain.value=ki}class ut{constructor(t,e=Wi,s=Yi){this.range=e,this.taper=s,this.randomness=0,this.sampleRate=Ie,this.loadedPercent=0,t&&(this.randomness=t[1]!==void 0?t[1]:.05,t[1]=0,this.sampleChannels=[fs(...t)],this.loadedPercent=1)}play(t,e=1,s=1,n=1,r=!1,o=!1){if(!this.sampleChannels)return;let h;if(t){const u=this.range;if(u){const l=yt.distanceSquared(t);if(l>u*u)return;e*=Dt(l**.5,u,u*this.taper)}h=Pe(t).x*2/C.width-1}const d=s+s*this.randomness*n*O(-1,1);return new cs(this,e,d,h,r,o)}playMusic(t=1,e=!0,s=!1){return this.play(void 0,t,1,0,e,s)}playNote(t,e,s){const n=us(t,1);return this.play(e,s,n,0)}getDuration(){return this.sampleChannels&&this.sampleChannels[0].length/this.sampleRate}isLoaded(){return this.loadedPercent===1}}class cs{constructor(t,e=1,s=1,n=0,r=!1,o=!1){this.sound=t,this.volume=e,this.rate=s,this.pan=n,this.loop=r,this.pausedTime=0,this.startTime=void 0,this.gainNode=void 0,this.source=void 0,this.onendedCallback=h=>{h===this.source&&(this.source=void 0)},o||this.start()}start(t=0){this.isPlaying()&&this.stop(),this.gainNode=F.createGain(),this.source=ds(this.sound.sampleChannels,this.volume,this.rate,this.pan,this.loop,this.sound.sampleRate,this.gainNode,t,this.onendedCallback),this.startTime=F.currentTime-t,this.pausedTime=void 0}setVolume(t){this.volume=t,this.gainNode&&(this.gainNode.gain.value=t)}stop(t=0){if(this.isPlaying())if(t){const e=F.currentTime,s=e+t;this.gainNode.gain.linearRampToValueAtTime(1,e),this.gainNode.gain.linearRampToValueAtTime(0,s),this.source.stop(s)}else this.source.stop();this.pausedTime=0,this.source=void 0,this.startTime=void 0}pause(){this.isPaused()||(this.pausedTime=this.getCurrentTime(),this.source.stop(),this.source=void 0,this.startTime=void 0)}resume(){this.isPaused()&&this.start(this.pausedTime)}isPlaying(){return!!this.source}isPaused(){return!this.isPlaying()}getCurrentTime(){const t=Ct(F.currentTime-this.startTime,this.getDuration());return this.isPlaying()?t:this.pausedTime}getDuration(){return this.sound.getDuration()/this.rate}getSource(){return this.source}}function us(i,t=220){return t*2**(i/12)}function ds(i,t=1,e=1,s=0,n=!1,r=Ie,o,h=0,d){const u=i.length,l=i[0].length,m=F.createBuffer(u,l,r),p=F.createBufferSource();i.forEach((y,x)=>m.getChannelData(x).set(y)),p.buffer=m,p.playbackRate.value=e,p.loop=n,o=o||F.createGain(),o.gain.value=t,o.connect(Qt);const g=new StereoPannerNode(F,{pan:P(s,-1,1)});if(p.connect(g).connect(o),d&&p.addEventListener("ended",()=>d(p)),!Oe()){F.resume();return}const f=h*e;return p.start(0,f),p}function fs(i=1,t=.05,e=220,s=0,n=0,r=.1,o=0,h=1,d=0,u=0,l=0,m=0,p=0,g=0,f=0,y=0,x=0,S=1,v=0,w=0,D=0){let T=Ie,A=Wt*2,E=d*=500*A/T/T,k=e*=(1+O(t,-t))*A/T,Lt=0,jt=0,St=0,ht=1,vt,ae=[],st=0,B=0,W=0,le,xi=2,Ue=A*X(D)*2/T,he=Math.cos(Ue),Ne=Math.sin(Ue)/2/xi,Vt=1+Ne,bi=-2*he/Vt,Si=(1-Ne)/Vt,_e=(1+Et(D)*he)/2/Vt,vi=-(Et(D)+he)/Vt,wi=_e,ke=0,We=0,Ye=0,Xe=0;for(s=s*T||9,v*=T,n*=T,r*=T,x*=T,u*=500*A/T**3,f*=A/T,l*=A/T,m*=T,p=p*T|0,vt=s+v+n+r+x|0;B<vt;ae[B++]=W*i)++St%(y*100|0)||(W=o?o>1?o>2?o>3?o>4?st/A%1<h/2?1:-1:Math.sin(st**3):Math.max(Math.min(Math.tan(st),1),-1):1-(2*st/A%2+2)%2:1-4*X(Math.round(st/A)-st/A):Math.sin(st),W=(p?1-w+w*Math.sin(A*B/p):1)*(o>4?W:Et(W)*X(W)**h)*(B<s?B/s:B<s+v?1-(B-s)/v*(1-S):B<s+v+n?S:B<vt-x?(vt-B-x)/r*S:0),W=x?W/2+(x>B?0:(B<vt-x?1:(vt-B)/x)*ae[B-x|0]/2/i):W,D&&(W=Xe=wi*ke+vi*(ke=We)+_e*(We=W)-Si*Ye-bi*(Ye=Xe))),le=(e+=d+=u)*Math.cos(f*Lt++),st+=le+le*g*Math.sin(B**5),ht&&++ht>m&&(e+=l,k+=l,ht=0),p&&!(++jt%p)&&(e=k,d=E,ht||=1);return ae}const gs=[];function qt(i,t=c(),e,s=!0){for(const n of gs)if((!s||n.isSolid)&&n.collisionTest(i,t,e))return n}class ps extends bt{constructor(t,e,s=0,n=0,r=100,o=Wt,h,d=new I,u=new I,l=new I(1,1,1,0),m=new I(1,1,1,0),p=.5,g=.1,f=1,y=.1,x=.05,S=1,v=1,w=0,D=Wt,T=.1,A=.2,E=!1,k=!1,Lt=!0,jt=k?1e9:0,St=!1){super(t,c(),h,e,void 0,jt),this.emitSize=s,this.emitTime=n,this.emitRate=r,this.emitConeAngle=o,this.colorStartA=d,this.colorStartB=u,this.colorEndA=l,this.colorEndB=m,this.randomColorLinear=Lt,this.particleTime=p,this.sizeStart=g,this.sizeEnd=f,this.speed=y,this.angleSpeed=x,this.damping=S,this.angleDamping=v,this.gravityScale=w,this.particleConeAngle=D,this.fadeRate=T,this.randomness=A,this.collideTiles=E,this.additive=k,this.localSpace=St,this.trailScale=0,this.particleDestroyCallback=void 0,this.particleCreateCallback=void 0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime||this.getAliveTime()<=this.emitTime){if(this.emitRate*Ve){const t=1/this.emitRate/Ve;for(this.emitTimeBuffer+=ne;this.emitTimeBuffer>0;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy()}emitParticle(){let t=typeof this.emitSize=="number"?Pi(this.emitSize/2):c(O(-.5,.5),O(-.5,.5)).multiply(this.emitSize).rotate(this.angle),e=O(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),e+=this.angle);const s=this.randomness,n=y=>y+y*O(s,-s),r=n(this.particleTime),o=n(this.sizeStart),h=n(this.sizeEnd),d=n(this.speed),u=n(this.angleSpeed)*ye(),l=O(this.emitConeAngle,-this.emitConeAngle),m=He(this.colorStartA,this.colorStartB,this.randomColorLinear),p=He(this.colorEndA,this.colorEndB,this.randomColorLinear),g=this.localSpace?l:this.angle+l,f=new ms(t,this.tileInfo,e,m,p,r,o,h,this.fadeRate,this.additive,this.trailScale,this.localSpace&&this,this.particleDestroyCallback);return f.velocity=c().setAngle(g,d),f.angleVelocity=u,this.localSpace||(f.velocity.x+=this.velocity.x,f.velocity.y+=this.velocity.y,f.angleVelocity+=this.angleVelocity),f.fadeRate=this.fadeRate,f.damping=this.damping,f.angleDamping=this.angleDamping,f.restitution=this.restitution,f.friction=this.friction,f.gravityScale=this.gravityScale,f.collideTiles=this.collideTiles,f.renderOrder=this.renderOrder,f.mirror=Ri(),this.particleCreateCallback&&this.particleCreateCallback(f),f}render(){}}class ms extends bt{constructor(t,e,s,n,r,o,h,d,u,l,m,p,g){super(t,c(),e,s),this.colorStart=n,this.colorEndDelta=r.subtract(n),this.lifeTime=o,this.sizeStart=h,this.sizeEndDelta=d-h,this.fadeRate=u,this.additive=l,this.trailScale=m,this.localSpaceEmitter=p,this.destroyCallback=g,this.clampSpeed=!1}update(){if(super.update(),this.collideTiles||this.collideSolidObjects){const t=this.velocity.lengthSquared();if(t>ft*ft){const e=ft/t**.5;this.velocity.x*=e,this.velocity.y*=e}}}render(){const t=this.lifeTime>0?gt((Q-this.spawnTime)/this.lifeTime,1):1,e=this.sizeStart+t*this.sizeEndDelta,s=c(e),n=this.fadeRate/2,r=new I(this.colorStart.r+t*this.colorEndDelta.r,this.colorStart.g+t*this.colorEndDelta.g,this.colorStart.b+t*this.colorEndDelta.b,(this.colorStart.a+t*this.colorEndDelta.a)*(t<n?t/n:t>1-n?(1-t)/n:1));this.additive&&Ke(!0);let o=this.pos,h=this.angle;if(this.localSpaceEmitter&&(o=this.localSpaceEmitter.pos.add(o.rotate(-this.localSpaceEmitter.angle)),h+=this.localSpaceEmitter.angle),this.trailScale){let d=this.velocity;this.localSpaceEmitter&&(d=d.rotate(-this.localSpaceEmitter.angle));const u=d.length();if(u){const l=d.scale(1/u),m=u*this.trailScale;s.y=At(s.x,m),h=l.angle(),it(o.add(l.multiply(c(0,-m/2))),s,this.tileInfo,r,h,this.mirror)}}else it(o,s,this.tileInfo,r,h,this.mirror);this.additive&&Ke(),t===1&&(this.color=r,this.size=s,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}let U,a,ys=!0,ee,ie,lt,Ht,Yt,mt,Le,Te,N,se,z;const Gt=5e5,je=11,ci=je*4,xs=Gt/ci|0,Me=3,ui=Me*4,bs=Gt/ui|0;function Ss(){if(!K||Li)return;if(U=document.createElement("canvas"),a=U.getContext("webgl2",{antialias:ys}),!a){console.warn("WebGL2 not supported, falling back to 2D canvas rendering!"),U=a=void 0,K=!1;return}C.parentElement.appendChild(U),ee=Ze(`#version 300 es
precision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}`,`#version 300 es
precision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}`),ie=Ze(`#version 300 es
precision highp float;uniform mat4 m;in vec2 p;in vec4 c;out vec4 d;void main(){gl_Position=m*vec4(p,1,1);d=c;}`,`#version 300 es
precision highp float;in vec4 d;out vec4 c;void main(){c=d;}`);const t=new ArrayBuffer(Gt);N=new Float32Array(t),se=new Uint32Array(t),Le=a.createBuffer(),Te=a.createBuffer();const e=new Float32Array([z=0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,Te),a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW)}function di(){if(!lt)return;Ot(),lt=!1,a.useProgram(ee);let i=0;const t=(e,s,n,r)=>{const o=a.getAttribLocation(ee,e),h=n&&ci,d=n&&1,u=n===1;a.enableVertexAttribArray(o),a.vertexAttribPointer(o,r,s,u,h,i),a.vertexAttribDivisor(o,d),i+=r*n};a.bindBuffer(a.ARRAY_BUFFER,Te),t("g",a.FLOAT,0,2),a.bindBuffer(a.ARRAY_BUFFER,Le),a.bufferData(a.ARRAY_BUFFER,Gt,a.DYNAMIC_DRAW),t("p",a.FLOAT,4,4),t("u",a.FLOAT,4,4),t("c",a.UNSIGNED_BYTE,1,4),t("a",a.UNSIGNED_BYTE,1,4),t("r",a.FLOAT,4,1)}function vs(){if(lt)return;Ot(),lt=!0,a.useProgram(ie);let i=0;const t=(e,s,n,r)=>{const o=a.getAttribLocation(ie,e),h=n===1,d=ui;a.enableVertexAttribArray(o),a.vertexAttribPointer(o,r,s,h,d,i),a.vertexAttribDivisor(o,0),i+=r*n};a.bindBuffer(a.ARRAY_BUFFER,Le),a.bufferData(a.ARRAY_BUFFER,Gt,a.DYNAMIC_DRAW),t("p",a.FLOAT,4,2),t("c",a.UNSIGNED_BYTE,1,4)}function qe(){if(!K||!a)return;ws();const i=c(2*L).divide(V),t=yt.rotate(-Ut),e=c(-1).subtract(t.multiply(i)),s=Math.cos(Ut),n=Math.sin(Ut),r=[i.x*s,i.y*n,0,0,-i.x*n,i.y*s,0,0,1,1,1,0,e.x,e.y,0,1],o=(h,d,u)=>{a.useProgram(h);const l=a.getUniformLocation(h,d);a.uniformMatrix4fv(l,!1,u)};o(ie,"m",r),o(ee,"m",r),a.activeTexture(a.TEXTURE0),It[0]&&(mt=It[0].glTexture,a.bindTexture(a.TEXTURE_2D,mt)),Ht=Yt=!1,lt=!0,di()}function ws(){a&&(U.width=be.width,U.height=be.height,a.viewport(0,0,U.width,U.height),a.clear(a.COLOR_BUFFER_BIT))}function Ts(i,t=!1){if(!a||i===mt)return;Ot(),mt=i,a.bindTexture(a.TEXTURE_2D,mt);const e=t?a.REPEAT:a.CLAMP_TO_EDGE;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,e)}function Qe(i,t){if(!a)return;const e=a.createShader(t);return a.shaderSource(e,i),a.compileShader(e),e}function Ze(i,t){if(!a)return;const e=a.createProgram();return a.attachShader(e,Qe(i,a.VERTEX_SHADER)),a.attachShader(e,Qe(t,a.FRAGMENT_SHADER)),a.linkProgram(e),e}function As(i){if(!a)return;const t=a.createTexture();let e=!1;if(i&&i.width)Es(t,i),a.bindTexture(a.TEXTURE_2D,t),e=!1;else{const r=new Uint8Array([255,255,255,255]);a.bindTexture(a.TEXTURE_2D,t),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,r)}const s=a.NEAREST,n=e?a.LINEAR_MIPMAP_LINEAR:s;return a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,n),e&&a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,mt),t}function Es(i,t){a&&(t&&t.width>0,a.bindTexture(a.TEXTURE_2D,i),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t),a.bindTexture(a.TEXTURE_2D,mt))}function Ot(){if(K&&a&&z){const i=Yt?a.ONE:a.ONE_MINUS_SRC_ALPHA;a.blendFuncSeparate(a.SRC_ALPHA,i,a.ONE,i),a.enable(a.BLEND);const t=z*(lt?Me:je);a.bufferSubData(a.ARRAY_BUFFER,0,N,0,t),lt?a.drawArrays(a.TRIANGLE_STRIP,0,z):a.drawArraysInstanced(a.TRIANGLE_STRIP,0,4,z),z=0}Yt=Ht}function fe(i,t,e,s,n=0,r=0,o=0,h=1,d=1,u=-1,l=0){(z>=xs||Yt!==Ht)&&Ot(),di(),lt=!1;let m=z++*je;N[m++]=i,N[m++]=t,N[m++]=e,N[m++]=s,N[m++]=r,N[m++]=o,N[m++]=h,N[m++]=d,se[m++]=u,se[m++]=l,N[m++]=n}function fi(i,t,e,s,n,r,o,h=!0){const d=[];for(const l of i){const m=l.x*n,p=l.y*r,g=Math.sin(-o),f=Math.cos(-o);d.push(c(e+f*m-g*p,s+g*m+f*p))}const u=h?Ds(d):d;Rs(u,t)}function Cs(i,t,e,s,n,r,o,h,d=!0){const u=Ps(i,e,d);fi(u,t,s,n,r,o,h,!1)}function Rs(i,t){if(!K||i.length<3)return;const e=i.length+2;(z+e>=bs||Yt!==Ht)&&Ot(),vs();let s=z*Me;for(let n=e;n--;){const r=P(n-1,0,e-3),o=i[r];N[s++]=o.x,N[s++]=o.y,se[s++]=t}z+=e}function Ps(i,t,e=!0){if(i.length<2)return[];const s=t/2,n=[],r=i.length,o=1e-6,h=t*100;for(let d=0;d<r;d++){const u=i[e?(d-1+r)%r:At(d-1,0)],l=i[d],m=i[e?(d+1)%r:gt(d+1,r-1)],p=l.x-u.x,g=l.y-u.y,f=(p*p+g*g)**.5,y=m.x-l.x,x=m.y-l.y,S=(y*y+x*x)**.5;if(f<o&&S<o)continue;const v=f>o?-g/f:0,w=f>o?p/f:0,D=S>o?-x/S:0,T=S>o?y/S:0;let A=v+D,E=w+T;const k=(A*A+E*E)**.5;if(k<o)A=v,E=w;else{A/=k,E/=k;const St=v*A+w*E;if(St>o){const ht=gt(1/St,h);A*=ht,E*=ht}}const Lt=c(l.x-A*s,l.y-E*s),jt=c(l.x+A*s,l.y+E*s);n.push(Lt),n.push(jt)}return n.length>1&&e&&(n.push(n[0]),n.push(n[1])),n}function Ds(i){if(i.length<3)return[];const t=(g,f,y)=>(f.x-g.x)*(y.y-g.y)-(f.y-g.y)*(y.x-g.x);(g=>{let f=0;for(let y=g.length;y--;){const x=(y+1)%g.length;f+=g[y].cross(g[x])}return f})(i)<0&&(i=i.reverse());const s=1e-9,n=(g,f,y,x)=>{const S=t(f,y,g),v=t(y,x,g),w=t(x,f,g),D=(S<-s?1:0)+(v<-s?1:0)+(w<-s?1:0),T=(S>s?1:0)+(v>s?1:0)+(w>s?1:0);return!(D&&T)},r=[];for(let g=0;g<i.length;++g)r[g]=g;const o=[];let h=0;const d=i.length**2+100;for(;r.length>3&&h++<d;){let g=!1;for(let f=0;f<r.length;f++){const y=r[(f+r.length-1)%r.length],x=r[f],S=r[(f+1)%r.length],v=i[y],w=i[x],D=i[S];if(t(v,w,D)<s)continue;let T=!1;for(let A=0;A<r.length;A++){const E=r[A];if(E===y||E===x||E===S)continue;const k=i[E];if(T=n(k,v,w,D),T)break}if(!T){o.push([y,x,S]),r.splice(f,1),g=!0;break}}if(!g){let f=-1,y=1/0;for(let w=0;w<r.length;w++){const D=r[(w+r.length-1)%r.length],T=r[w],A=r[(w+1)%r.length],E=X(t(i[D],i[T],i[A]));E<y&&(y=E,f=w)}if(f<0)break;const x=r[(f+r.length-1)%r.length],S=r[f],v=r[(f+1)%r.length];o.push([x,S,v]),r.splice(f,1)}}if(r.length===3&&o.push([r[0],r[1],r[2]]),!o.length)return[];const u=[];let[l,m,p]=o[0];u.push(i[l],i[m],i[p]);for(let g=1;g<o.length;g++){const[f,y,x]=o[g];u.push(i[p],i[f]),u.push(i[f],i[y],i[x]),p=x}return u}let b;class Is{constructor(t=tt){b=this,this.defaultColor=xt,this.defaultLineColor=at,this.defaultTextColor=at,this.defaultButtonColor=G(0,0,.7),this.defaultHoverColor=G(0,0,.9),this.defaultDisabledColor=G(0,0,.3),this.defaultLineWidth=4,this.defaultCornerRadius=0,this.defaultTextScale=.8,this.defaultFont="arial",this.defaultSoundPress=void 0,this.defaultSoundRelease=void 0,this.defaultSoundClick=void 0,this.uiObjects=[],this.uiContext=t,this.hoverObject=void 0,this.activeObject=void 0,Ai(e,s);function e(){function n(o){for(const h of o.children)n(h);o.updateInvisible()}function r(o){if(o.visible){o.parent&&(o.pos=o.localPos.add(o.parent.pos));for(let h=o.children.length;h--;)r(o.children[h]);o.update()}else n(o)}b.hoverObject=void 0;for(let o=b.uiObjects.length;o--;){const h=b.uiObjects[o];h.parent||r(h)}}function s(){function n(r){if(r.visible){r.parent&&(r.pos=r.localPos.add(r.parent.pos)),r.render();for(const o of r.children)n(o)}}b.uiObjects.forEach(r=>r.parent||n(r))}}drawRect(t,e,s=b.defaultColor,n=b.defaultLineWidth,r=b.defaultLineColor,o=b.defaultCornerRadius){const h=b.uiContext;h.fillStyle=s.toString(),h.beginPath(),o&&h.roundRect?h.roundRect(t.x-e.x/2,t.y-e.y/2,e.x,e.y,o):h.rect(t.x-e.x/2,t.y-e.y/2,e.x,e.y),h.fill(),n&&(h.strokeStyle=r.toString(),h.lineWidth=n,h.stroke())}drawLine(t,e,s=b.defaultLineWidth,n=b.defaultLineColor){const r=b.uiContext;r.strokeStyle=n.toString(),r.lineWidth=s,r.beginPath(),r.lineTo(t.x,t.y),r.lineTo(e.x,e.y),r.stroke()}drawTile(t,e,s,n=b.defaultColor,r=0,o=!1){it(t,e,s,n,r,o,ni,!1,!0,b.uiContext)}drawText(t,e,s,n=b.defaultColor,r=b.defaultLineWidth,o=b.defaultLineColor,h="center",d=b.defaultFont,u=!0){Zi(t,e,s.y,n,r,o,h,d,u?s.x:void 0,b.uiContext)}}class Fe{constructor(t=c(),e=c()){this.localPos=t.copy(),this.pos=t.copy(),this.size=e.copy(),this.color=b.defaultColor,this.activeColor=void 0,this.text=void 0,this.disabledColor=b.defaultDisabledColor,this.disabled=!1,this.textColor=b.defaultTextColor,this.hoverColor=b.defaultHoverColor,this.lineColor=b.defaultLineColor,this.lineWidth=b.defaultLineWidth,this.cornerRadius=b.defaultCornerRadius,this.font=b.defaultFont,this.textWidth=void 0,this.textHeight=void 0,this.textScale=b.defaultTextScale,this.visible=!0,this.children=[],this.parent=void 0,this.extraTouchSize=0,this.soundPress=b.defaultSoundPress,this.soundRelease=b.defaultSoundRelease,this.soundClick=b.defaultSoundClick,this.interactive=!1,this.dragActivate=!1,b.uiObjects.push(this)}addChild(t){!t.parent&&this.children.includes(t),this.children.push(t),t.parent=this}removeChild(t){t.parent===this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=void 0}update(){const t=this.isHoverObject(),e=this.isActiveObject(),s=hi(0),n=this.dragActivate?s:ss(0);if(!b.hoverObject&&(n||e||!s&&!Rt)){const r=this.size.add(c(Rt&&this.extraTouchSize||0));me(this.pos,r,rt)&&(b.hoverObject=this)}this.isHoverObject()&&(n&&is(0,0,0,1,0),this.disabled||(n&&this.interactive&&(this.onPress(),this.soundPress&&this.soundPress.play(),b.activeObject&&!e&&b.activeObject.onRelease(),b.activeObject=this),!s&&b.activeObject===this&&this.interactive&&(this.onClick(),this.soundClick&&this.soundClick.play()))),e&&(!s||this.dragActivate&&!this.isHoverObject())&&(this.onRelease(),this.soundRelease&&this.soundRelease.play(),b.activeObject=void 0),this.isHoverObject()!==t&&(this.isHoverObject()?this.onEnter():this.onLeave())}render(){if(!this.size.x||!this.size.y)return;const t=this.interactive&&this.isActiveObject()&&!this.disabled?this.color:this.lineColor,e=this.interactive?this.disabled?this.disabledColor:this.isActiveObject()?this.activeColor||this.color:this.isHoverObject()?this.hoverColor:this.color:this.color;b.drawRect(this.pos,this.size,e,this.lineWidth,t,this.cornerRadius)}updateInvisible(){this.isActiveObject()&&(b.activeObject=void 0)}getTextSize(){return c(this.textWidth||this.textScale*this.size.x,this.textHeight||this.textScale*this.size.y)}isHoverObject(){return b.hoverObject===this}isActiveObject(){return b.activeObject===this}onEnter(){}onLeave(){}onPress(){}onRelease(){}onClick(){}onChange(){}}class Os extends Fe{constructor(t,e,s="",n="center",r=b.defaultFont){super(t,e),this.text=s,this.align=n,this.font=r,this.lineWidth=0}render(){const t=this.getTextSize();b.drawText(this.text,this.pos,t,this.textColor,this.lineWidth,this.lineColor,this.align,this.font)}}class ge extends Fe{constructor(t,e,s="",n=b.defaultButtonColor){super(t,e),this.text=s,this.color=n,this.interactive=!0}render(){super.render();const t=this.getTextSize();b.drawText(this.text,this.pos,t,this.textColor,0,void 0,this.align,this.font)}}const Z={baseEnemiesToSpawn:5,baseDamage:25,baseRange:15,baseFireRate:.5,baseProjectilesPerShot:1,baseProjectileSpeed:.5,baseBugSpeed:.1,basePlayerSpeed:.25,playerDamageCooldown:2,projectileColor:G(.175,.64,.6)},Xt={shoot:new ut([1.1,,256,,.03,.01,1,2.4,,,-109,.26,.08,.3,8.7,,,.91,,.02]),explosion:new ut([,,90,,.01,.03,4,,,,,,,9,50,.2,,.2,2]),playerHit:new ut([2.6,,118,.02,,.07,2,3.9,,,,,,.9,37,.2,.07,.9,.04,,-2500]),bugHit:new ut([1.3,,830,.02,.02,.03,,.3,,,-25,,.02,,18,.2,.01,.92,.02,.02]),bugKilled:new ut([2,,326,.02,.07,.02,4,,,,,,,1.9,,.1,.14,.67,.05,,99]),powerup:new ut([.8,,560,.07,.16,.13,5,1.2045952224567127,,-36,,,,,,,.18,.79,.14,,-1500]),upgrade:new ut([,,404,.05,.23,.39,1,2,,130,,,,,12,,,.52,.24,,-799])};class gi extends bt{moveDirection;weapon;health;speed;recoverTimer;constructor(t,e,s){super(t,e),this.weapon=s,this.moveDirection=c(0),this.tileInfo=Ae(0,c(51,43),1),this.health=3,this.recoverTimer=new Ii(0),this.speed=Z.basePlayerSpeed,this.setCollision()}update(){super.update(),this.moveDirection=this.moveDirection.clampLength(1).scale(this.speed),this.velocity=this.moveDirection,this.angle=-Math.atan2(this.pos.y-te.y,this.pos.x-te.x)+Math.PI,this.weapon.timeSinceLastShot+=ne}fire(t){this.weapon.fire(this.pos,t)}render(){this.recoverTimer.elapsed()?it(this.pos,this.size,this.tileInfo,void 0,this.angle):it(this.pos,this.size,this.tileInfo,G(1,1,1,.5),this.angle)}collideWithObject(t){return t.constructor.name==="Projectile"?!1:(t.constructor.name==="Bug"&&this.recoverTimer.elapsed()&&(Xt.playerHit.play(),this.health--,this.recoverTimer.set(Z.playerDamageCooldown)),!0)}}class pi extends bt{startPos;damage;range;constructor(t,e,s,n,r,o,h){super(t,c(e)),this.startPos=t,this.damage=n,this.range=r,this.color=h,this.velocity=s.subtract(t).normalize(o),this.setCollision()}update(){super.update(),Math.sqrt(Math.pow(this.pos.x-this.startPos.x,2)+Math.pow(this.pos.y-this.startPos.y,2))>this.range&&this.destroy()}render(){Qi(this.pos,this.size.x,this.color)}collideWithObject(t){return t.constructor.name!=="Wall"}}class Ls extends bt{constructor(t,e){super(t,e),this.setCollision(!0,!1,!1,!1)}render(){it(this.pos,c(2),Ae(0,c(16,16),2))}collideWithObject(t){return t instanceof gi}}class Bt extends bt{constructor(t,e){super(t,e),this.setCollision(),this.mass=0}}class js extends bt{targetPosition;health;speed;constructor(t,e,s){super(t,e),this.setCollision(),this.speed=s,this.targetPosition=c(0,0),this.health=100}update(){super.update();const t=Math.sqrt(Math.pow(this.targetPosition.x-this.pos.x,2)+Math.pow(this.targetPosition.y-this.pos.y,2));let e=Math.min(t,25),s=this.targetPosition.x+Y(e)*ye()-this.pos.x,n=this.targetPosition.y+Y(e)*ye()-this.pos.y,r=c(s,n).normalize(1).scale(this.speed);this.velocity=r,this.angle=-Math.atan2(this.pos.y-this.targetPosition.y,this.pos.x-this.targetPosition.x)+Math.PI/2}render(){it(this.pos,c(2,2.5),Ae(0,c(60,80),0,15),void 0,this.angle)}collideWithObject(t){if(t instanceof Bt)return!1;if(t instanceof pi){Xt.bugHit.play();let e=t;this.health-=e.damage,e.destroy(),new ps(this.pos,void 0,1,.1,100,Math.PI,void 0,G(0,1,.6),G(0,1,.6),G(0,1,.6),G(0,1,.6),void 0,.25,0),this.health<=0&&(Xt.bugKilled.play(),O(0,1)<.5&&new Ls(this.pos,c(1)),this.destroy())}return!0}}class Ms{damage;range;fireRate;projectilesPerShot;timeSinceLastShot;projectileSpeed;projectileColor;constructor(t,e,s,n,r,o){this.damage=t,this.range=e,this.fireRate=s,this.projectilesPerShot=n,this.projectileSpeed=r,this.projectileColor=o,this.timeSinceLastShot=100}fire(t,e){this.timeSinceLastShot+=ne;let s=e.copy();if(this.timeSinceLastShot>=this.fireRate){Xt.shoot.play();for(let n=0;n<this.projectilesPerShot;n++)n>0&&(s=s.copy().rotate(O(.2)*(Y(2)===0?1:-1))),new pi(t,this.damage/100,s,this.damage,this.range,this.projectileSpeed,this.projectileColor);this.timeSinceLastShot=0}}}const $e=[{displayName:"damage up",upgradeFunc:i=>i.damage+=10},{displayName:"fire rate up",upgradeFunc:i=>i.fireRate-=.05},{displayName:"range up",upgradeFunc:i=>i.range+=10},{displayName:"shot speed up",upgradeFunc:i=>i.projectileSpeed+=.1},{displayName:"more bullets",upgradeFunc:i=>i.projectilesPerShot++}],Fs=G(1.27,.51,.17);let H,nt=[],Zt=!1,Pt=0,zt=0,oe=!1,$t=0,Bs=.25,$,Nt,_t,kt;function mi(){return Pt*Z.baseEnemiesToSpawn}function Us(i){for(let t=0;t<i;t++){let e,s;Y(2)===0?(e=Y(M.x/L/2)*(Y(2)===0?-1:1),s=M.y/L/2*(Y(2)===0?-1:1)):(e=M.x/L/2*(Y(2)===0?-1:1),s=Y(M.y/L/2)*(Y(2)===0?-1:1)),nt.push(new js(c(e,s),c(.75,1),Z.baseBugSpeed))}}function Be(){$.visible=!1,oe=!0,zt=0,Pt++;const i=[];for(;i.length<3;){const e=$e[Math.floor(Math.random()*$e.length)];i.includes(e)||i.push(e)}const t=(e,s)=>{Xt.upgrade.play(),s(e),Be()};Nt.text=i[0].displayName,_t.text=i[1].displayName,kt.text=i[2].displayName,Nt.onClick=()=>t(H.weapon,i[0].upgradeFunc),_t.onClick=()=>t(H.weapon,i[1].upgradeFunc),kt.onClick=()=>t(H.weapon,i[2].upgradeFunc)}function yi(){H=new gi(yt,c(2,1.5),new Ms(Z.baseDamage,Z.baseRange,Z.baseFireRate,Z.baseProjectilesPerShot,Z.baseProjectileSpeed,Z.projectileColor))}function Ns(){nt.forEach(i=>i.destroy()),nt=[],yi(),Pt=0,zt=0,oe=!1,$t=0,Be()}function _s(){zi(c(1920,1080)),Xi(Fs),new Bt(c(0,M.y/L/2+1),c(M.x/L,2)),new Bt(c(0,-(M.y/L/2)-1),c(M.x/L,2)),new Bt(c(-(M.x/L/2)-1,0),c(2,M.y/L)),new Bt(c(M.x/L/2+1,0),c(2,M.y/L)),yi(),new Is,b.defaultCornerRadius=5,$=new Fe(V.scale(.5),c(600,450)),$.addChild(new Os(c(0,-120),c(400,50),"Choose an upgrade")),Nt=new ge(c(0,-10),c(300,50)),Nt.textHeight=30,$.addChild(Nt),_t=new ge(c(0,50),c(300,50)),_t.textHeight=30,$.addChild(_t),kt=new ge(c(0,110),c(300,50)),kt.textHeight=30,$.addChild(kt),$.visible=!1}function ks(){if(!Zt){ve("Space")&&(Zt=!0,Be());return}if(H.health<=0){H.destroy(),ve("Space")&&Ns();return}if(Zt&&oe){if($t+=ne,$t>=Bs&&zt<mi()){let i=2;Us(i),zt+=i,$t=0}hi(0)&&H.fire(te),H.moveDirection=es();for(let i=nt.length-1;i>=0;i--)nt[i].destroyed&&nt.splice(i,1);nt.forEach(i=>i.targetPosition=H.pos)}}function Ws(){}function Ys(){}function Xs(){const i=V.scale(.5),t=new ts;if(!Zt){Vi(c(0,-3),c(30,10),G(0,0,0)),t.drawTextScreen("Press space to start",i,5,!0),t.drawTextScreen("WASD to move",c(i.x,i.y+100),3,!0),t.drawTextScreen("Point and click to shoot",c(i.x,i.y+150),3,!0);return}H.health<=0&&(t.drawTextScreen("Game Over",i,6,!0),t.drawTextScreen(`You survived until wave ${Pt}`,c(i.x,i.y+100),3,!0),t.drawTextScreen("Press space to restart",c(i.x,i.y+150),3,!0)),t.drawTextScreen(`Wave ${Pt}`,c(20,40),3),t.drawTextScreen(`Health ${H.health}`,c(20,90),3),Pt>0&&nt.length===0&&zt>=mi()&&(oe=!1,$.pos=i,$.visible=!0)}Ei(_s,ks,Ws,Ys,Xs,["Ants.png","survivor1_machine.png","items/bomb.png"]);
